/*! For license information please see main.a8af3f68859c5b594641.bundle.js.LICENSE.txt */
(()=>{var e,t={876:(e,t,s)=>{"use strict";s(260);var i=s(227);class r extends Phaser.Plugins.ScenePlugin{constructor(e,t){super(e,t,"utils")}init(e){this.tilemap=e}filterObjectsByLayerAndProperties(e,t){return this.tilemap.filterObjects(e,(e=>{const s=this.getPropertiesAsObject(e);return!!s&&Object.keys(t).every((e=>s[e]===t[e]))}))||[]}findObjectByLayerAndName(e,t){return this.tilemap.findObject(e,(e=>e.name===t))||null}filterObjectsByLayerAndName(e,t){return this.tilemap.filterObjects(e,(e=>e.name===t))||[]}getPropertiesAsObject(e){return e.properties?e.properties.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.name]:t.value})),{}):null}coordinatesAreNear(e,t,s=10){const i=e.x-t.x,r=e.y-t.y,o=Math.sqrt(i*i+r*r);return Math.abs(o)<s}findObjectOnGroupByData(e,t){if((null==e?void 0:e.getLength())>0)return e.children.getArray().find((e=>Object.keys(t).every((s=>e.getData(s)===t[s]))))}iterateOnGroup(e,t){(null==e?void 0:e.getLength())>0&&e.children.iterate(t)}findObjectOnGroup(e,t){return(null==e?void 0:e.getLength())>0&&e.children.getArray().find(t)}intersectObjects(e,t){return(0,Phaser.Geom.Intersects.RectangleToRectangle)(e.getBounds(),t.getBounds())}findObjectByLayerAndProperties(e,t){return this.tilemap.findObject(e,(e=>{const s=this.getPropertiesAsObject(e);return Object.keys(t).every((e=>s[e]===t[e]))}))||null}getMiddleSceneCoordinates(){return{x:this.scene.cameras.main.worldView.x+this.scene.cameras.main.width/2,y:this.scene.cameras.main.worldView.y+this.scene.cameras.main.height/2}}shakeOnTpCollision(){this.scene.cameras.main.shake(50,.01)}}class o extends Phaser.Plugins.ScenePlugin{constructor(e,t){super(e,t,"store"),this.prefix="paradoxe-game."}set(e,t){localStorage.setItem(this.prefix+e,JSON.stringify(t)),this.scene.events.emit("Store::"+e,t)}get(e){const t=localStorage.getItem(this.prefix+e);return t?JSON.parse(t):null}remove(e){localStorage.removeItem(this.prefix+e)}}class a extends Phaser.Plugins.ScenePlugin{constructor(e,t){super(e,t,"translate")}get(e,t){var s,i,r;if(this.translations||(this.translations=this.scene.cache.json.get("translations")),this.lang=null!==(s=this.scene.store.get("lang"))&&void 0!==s?s:"fr",!(null===(r=null===(i=this.translations[e])||void 0===i?void 0:i[this.lang])||void 0===r?void 0:r[t]))throw new Error(`translation not found for key ${e} and index ${t}`);return this.translations[e][this.lang][t]}}const n=e=>(t,s,i)=>{const r=i.value;let o=0;i.value=function(...t){const s=(new Date).getTime();s>o&&(o=s+e,r.call(this,...t))}};var h,l,c,d;!function(e){e.BaseLevel="BaseLevel",e.PreloadStartScreen="PreloadStartScreen",e.StartScreen="StartScreen",e.PreloadTutorials="PreloadTutorials",e.Tutorials="Tutorials",e.PreloadLevel0="PreloadLevel0",e.Level0="Level0",e.PreloadLevel1="PreloadLevel1",e.Level1="Level1",e.PreloadLevel2="PreloadLevel2",e.Level2="Level2",e.PreloadLevel3="PreloadLevel3",e.Level3="Level3",e.PreloadLevel4="PreloadLevel4",e.Level4="Level4"}(h||(h={})),function(e){e.DOOR_START="start",e.CORPSE="corpse",e.DOOR_END="end",e.START="start",e.END="end",e.STAIRS_LINE="stairs_line",e.SPATIAL_DOOR="spatial_door"}(l||(l={})),function(e){e.EVENTS="events",e.DIALOGS="dialogs",e.SPATIAL_TELEPORTERS="spatial_teleporters",e.TIME_TELEPORTERS="time_teleporters",e.TIME_SWITCHERS="time_switchers",e.PLAYER="player",e.DOORS="doors",e.STAIRS_DETECTION="stairs_detection",e.CEILING="ceiling",e.LIGHTS="lights",e.OPTIONS="options",e.PLATFORMS="platforms",e.DESKS="desks",e.WALL2="wall2",e.WALL="wall",e.BRIDGES="bridges",e.TP="tp",e.GROUND="ground",e.BACKGROUND="background",e.STAIRS="stairs",e.PLATFORM_COLLIDERS="platform_colliders",e.TITLE="title"}(c||(c={})),function(e){e[e.PLAYER=1]="PLAYER",e[e.BRIDGES=2]="BRIDGES",e[e.UI=3]="UI",e[e.TEXT_BOX=4]="TEXT_BOX"}(d||(d={}));var p,u,y=function(e,t,s,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(a=(o<3?r(a):o>3?r(t,s,a):r(t,s))||a);return o>3&&a&&Object.defineProperty(t,s,a),a};!function(e){e[e.TUTORIALS=0]="TUTORIALS",e[e.NEWGAME=1]="NEWGAME",e[e.CONTINUE=2]="CONTINUE",e[e.OPTIONS=3]="OPTIONS"}(p||(p={})),function(e){e[e.MUSIC=0]="MUSIC",e[e.FX=1]="FX",e[e.FULLSCREEN=2]="FULLSCREEN",e[e.BACK=3]="BACK"}(u||(u={}));class m extends Phaser.Scene{constructor(){super({key:h.StartScreen})}preload(){this.load.json("translations","assets/json/options/translations.json"),this.load.image("logo","assets/img/logo.png"),this.load.image("right","assets/img/ui/right.png"),this.load.audio("switcher","assets/sounds/switcher.wav"),this.load.audio("levels","assets/sounds/levels.wav"),this.load.audio("door_open","assets/sounds/door_open.wav")}create(){var e,t;const{x:s,y:i}=this.utils.getMiddleSceneCoordinates();this.add.image(s,i-70,"logo").setScale(.2),this.hasFx=null===(e=this.store.get("fx"))||void 0===e||e,this.hasMusic=null===(t=this.store.get("music"))||void 0===t||t,this.music=this.sound.add("levels"),this.launchMusic(),this.events.on("Store::fx",(e=>{this.hasFx=e})),this.events.on("Store::music",(e=>{this.hasMusic=e,this.hasMusic?this.launchMusic():this.music.pause()})),this.showMainMenu(),this.up=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.UP),this.down=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.DOWN),this.left=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.LEFT),this.right=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.RIGHT),this.enter=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER)}update(){this.moveCursor(),"main_menu"===this.menu&&this.selectInMainMenu(),"options_menu"===this.menu&&this.selectInOptionsMenu()}launchMusic(){this.hasMusic&&!this.music.isPlaying&&(this.musicHasBeenPlayed?this.music.resume():(this.musicHasBeenPlayed=!0,this.music.play({loop:!0,volume:.1})))}selectInMainMenu(){if(this.enter.isDown)switch(this.hasFx&&this.sound.play("door_open"),this.currentButtonIndex){case p.TUTORIALS:this.music.stop(),this.scene.start(h.PreloadTutorials);break;case p.NEWGAME:this.music.stop(),this.store.set("score",0),this.scene.start(h.PreloadLevel1);break;case p.CONTINUE:{if(!this.continueButton){this.time.delayedCall(500,(()=>{this.showOptionsMenu()}));break}const e=this.store.get("level");e&&(this.music.stop(),this.scene.start(e));break}case p.OPTIONS:this.time.delayedCall(500,(()=>{this.showOptionsMenu()}))}}selectInOptionsMenu(){if(this.enter.isDown)switch(this.hasFx&&this.sound.play("door_open"),this.currentButtonIndex){case u.MUSIC:this.store.set("music",!this.hasMusic),this.musicButton.setAlpha(this.hasMusic?1:.5);break;case u.FX:this.store.set("fx",!this.hasFx),this.fxButton.setAlpha(this.hasFx?1:.5);break;case u.FULLSCREEN:this.scale.isFullscreen?(this.scale.stopFullscreen(),this.fullScreenButton.setAlpha(.5)):(this.scale.startFullscreen(),this.fullScreenButton.setAlpha(1));break;case u.BACK:this.time.delayedCall(500,(()=>{this.showMainMenu()}))}}showMainMenu(){var e,t;this.destroyOptionsMenu(),null===(e=this.cursor)||void 0===e||e.destroy(),null===(t=this.container)||void 0===t||t.destroy(),this.menu="main_menu",this.currentButtonIndex=0;const{x:s,y:i}=this.utils.getMiddleSceneCoordinates();this.tutorialsButton=this.addText(s,i-30,"TUTORIALS"),this.newGameButton=this.addText(s,i,"NEW GAME");const r=[];r.push(this.tutorialsButton,this.newGameButton),this.store.get("level")&&(this.continueButton=this.addText(s,i+30,"CONTINUE"),r.push(this.continueButton)),this.optionsButton=this.addText(s,i+(this.continueButton?60:30),"OPTIONS"),r.push(this.optionsButton),this.container=this.add.container(0,0,r),this.createCursor()}showOptionsMenu(){var e,t;this.destroyMainMenu(),null===(e=this.cursor)||void 0===e||e.destroy(),null===(t=this.container)||void 0===t||t.destroy(),this.menu="options_menu",this.currentButtonIndex=0;const{x:s,y:i}=this.utils.getMiddleSceneCoordinates();this.musicButton=this.addText(s,i-30,"MUSIC").setAlpha(this.hasMusic?1:.5),this.fxButton=this.addText(s,i,"FX").setAlpha(this.hasFx?1:.5),this.fullScreenButton=this.addText(s,i+30,"FULL SCREEN").setAlpha(this.scale.isFullscreen?1:.5),this.backButton=this.addText(s,i+60,"BACK");const r=[];r.push(this.musicButton,this.fxButton,this.fullScreenButton,this.backButton),this.container=this.add.container(0,0,r),this.createCursor()}destroyMainMenu(){var e,t,s,i;null===(e=this.tutorialsButton)||void 0===e||e.destroy(),null===(t=this.newGameButton)||void 0===t||t.destroy(),null===(s=this.continueButton)||void 0===s||s.destroy(),null===(i=this.optionsButton)||void 0===i||i.destroy()}destroyOptionsMenu(){var e,t,s;null===(e=this.musicButton)||void 0===e||e.destroy(),null===(t=this.fxButton)||void 0===t||t.destroy(),null===(s=this.backButton)||void 0===s||s.destroy()}createCursor(){this.currentSelectedButton=this.container.getAt(this.currentButtonIndex);const{x:e,y:t,width:s}=this.currentSelectedButton;this.cursor=this.add.image(e-s,t,"right").setScale(.3)}moveCursor(){(this.up.isDown||this.down.isDown)&&this.hasFx&&this.sound.play("switcher"),this.up.isDown?this.currentButtonIndex>=1?this.currentButtonIndex--:this.currentButtonIndex=this.container.length-1:this.down.isDown&&(this.currentButtonIndex<this.container.length-1?this.currentButtonIndex++:this.currentButtonIndex=0),this.currentSelectedButton=this.container.getAt(this.currentButtonIndex);const{x:e,y:t,width:s}=this.currentSelectedButton;this.cursor.setPosition(e-s,t)}addText(e,t,s){return this.add.text(Math.round(e),Math.round(t),s,{fontFamily:"Pixels",align:"center"}).setScale(1).setFontSize(15).setResolution(10).setOrigin(.5,.5).setColor("white")}}y([n(130)],m.prototype,"selectInMainMenu",null),y([n(130)],m.prototype,"selectInOptionsMenu",null),y([n(130)],m.prototype,"moveCursor",null);class g extends Phaser.Scene{constructor(e,t,s){super({key:e}),this.nextScene=t,this.tilesetKey=s,this.key=e}preload(){const e=this.add.graphics(),t=this.add.graphics();t.fillStyle(2236962,.8),t.fillRect(140,240,320,50);const s=this.cameras.main.width,i=this.cameras.main.height,r=this.make.text({x:s/2,y:i/2-50,text:"Loading...",style:{font:"20px Pixels",color:"#ffffff"}});r.setOrigin(.5,.5);const o=this.make.text({x:s/2,y:i/2-30,text:"0%",style:{font:"18px Pixels",color:"#ffffff"}});o.setOrigin(.5,.5);const a=this.make.text({x:s/2,y:i/2+70,text:"",style:{font:"18px Pixels",color:"#ffffff"}});a.setOrigin(.5,.5),this.load.on("progress",(t=>{e.clear(),e.fillStyle(16777215,1),e.fillRect(140,240,300*t,30),o.setText(parseInt((100*t).toString())+"%")})),this.load.on("fileprogress",(e=>{const t=e.src.split("/"),s=t[t.length-1];a.setText("Loading asset: "+s)})),this.load.on("complete",(()=>{a.destroy(),o.destroy(),r.destroy(),e.destroy(),t.destroy(),this.load.off("progress"),this.load.off("fileprogress"),this.load.off("complete")})),this.load.json("translations","assets/json/options/translations.json"),this.load.scenePlugin({key:"rexUI",sceneKey:"rexUI"}),this.load.image("nextPage","assets/img/ui/arrow-down-left.png"),this.load.image("dialogEnd","assets/img/ui/cancel.png"),this.load.audio("death","assets/sounds/death.wav"),this.load.audio("door_tp","assets/sounds/door_tp.wav"),this.load.audio("simple_gun_shot","assets/sounds/simple_gun_shot.wav"),this.load.audio("levels","assets/sounds/levels.wav"),this.load.audio("tp","assets/sounds/tp.wav"),this.load.audio("walk","assets/sounds/walk.wav"),this.load.audio("switcher","assets/sounds/switcher.wav"),this.load.audio("door_open","assets/sounds/door_open.wav"),this.load.audio("door_close","assets/sounds/door_close.wav"),this.load.audio("end_level","assets/sounds/end_level.wav"),this.load.image("tileset","assets/img/tileset.png"),this.load.image("door_start","assets/img/objects/door_start.png"),this.load.image("door_end_open","assets/img/objects/door_end_open.png"),this.load.image("door_end_close","assets/img/objects/door_end_close.png"),this.load.image("door_tp_red","assets/img/objects/door_tp_red.png"),this.load.image("door_tp_green","assets/img/objects/door_tp_green.png"),this.load.image("door_tp_full_red","assets/img/objects/door_tp_full_red.png"),this.load.image("door_tp_full_green","assets/img/objects/door_tp_full_green.png"),this.load.image("tp_red","assets/img/objects/tp_red.png"),this.load.image("tp_red_close","assets/img/objects/tp_red_close.png"),this.load.image("tp_orange","assets/img/objects/tp_orange.png"),this.load.image("tp_orange_close","assets/img/objects/tp_orange_close.png"),this.load.image("tp_green","assets/img/objects/tp_green.png"),this.load.image("tp_green_close","assets/img/objects/tp_green_close.png"),this.load.image("switcher_red","assets/img/objects/switcher_red.png"),this.load.image("switcher_green","assets/img/objects/switcher_green.png"),this.load.image("switcher_orange","assets/img/objects/switcher_orange.png"),this.load.image("reset","assets/img/ui/return.png"),this.load.image("exit","assets/img/ui/exit.png"),this.load.image("audio_on","assets/img/ui/audioOn.png"),this.load.image("audio_off","assets/img/ui/audioOff.png"),this.load.image("music_on","assets/img/ui/musicOn.png"),this.load.image("music_off","assets/img/ui/musicOff.png"),this.load.tilemapTiledJSON(this.tilesetKey,`assets/json/levels/${this.tilesetKey}.json`),this.load.atlas("player","assets/img/chars/player_atlas.png","assets/json/chars/player_atlas.json"),this.load.atlas("past_player","assets/img/chars/past_player_atlas.png","assets/json/chars/past_player_atlas.json"),this.load.atlas("simple_bullet","assets/img/objects/simple_bullet_atlas.png","assets/json/objects/simple_bullet_atlas.json"),this.load.atlas("simple_gun_shot","assets/img/particles/simple_gun_shot.png","assets/json/particles/simple_gun_shot.json")}create(){this.key!==h.PreloadTutorials&&this.store.set("level",this.key),this.scene.start(this.nextScene)}}class v extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"door_start"),e.add.existing(this)}}class f extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){var i;super(e,t,s,"door_end_open"),e.add.existing(this),this.hasFx=null===(i=this.scene.store.get("fx"))||void 0===i||i,this.create()}create(){this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}open(){this.setTexture("door_end_open"),this.hasFx&&this.scene.sound.play("door_open")}close(){this.setTexture("door_end_close"),this.hasFx&&this.scene.sound.play("door_close")}}class x extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,r){var o;super(e,t,s,"switcher_red"),this.group=i,this.num=r,e.add.existing(this),this.hasFx=null===(o=this.scene.store.get("fx"))||void 0===o||o,this.create()}create(){this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}activate(){this.hasFx&&this.scene.sound.play("switcher"),this.scene.events.emit("DoubleSwitcher::activate",this.group)}}!function(e,t,s,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(a=(o<3?r(a):o>3?r(t,s,a):r(t,s))||a);o>3&&a&&Object.defineProperty(t,s,a)}([n(500)],x.prototype,"activate",null);class T extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,r){var o;super(e,t,s,"tp_red"),this.group=i,this.num=r,this.alive=!0,e.add.existing(this),this.scene.physics.world.enable(this),this.setImmovable(!0),this.hasFx=null===(o=this.scene.store.get("fx"))||void 0===o||o,this.create()}create(){this.scene.events.on("DoubleSwitcher::activate",(e=>{this.switch(e)})),this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}switch(e){this.group===e&&(this.alive?(this.alive=!1,this.setTexture("tp_red_close"),this.scene.events.emit("DoubleTimeTeleporter::isClosed",this)):(this.alive=!0,this.setTexture("tp_red"),this.scene.events.emit("DoubleTimeTeleporter::isOpen",this)))}addOpposite(e){this.oppositeDoubleTimeTeleporter=e}activate(){this.hasFx&&this.scene.sound.play("tp"),this.scene.events.emit("DoubleTimeTeleporter::activate",{x:this.x,y:this.y},this.getOppositeCoordinates())}getOppositeCoordinates(){const{x:e,y:t}=this.oppositeDoubleTimeTeleporter;return{x:e,y:t}}}class b extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,r){var o;super(e,t,s,"switcher_orange"),this.group=i,this.num=r,e.add.existing(this),this.hasFx=null===(o=this.scene.store.get("fx"))||void 0===o||o,this.create()}create(){this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}activate(){this.hasFx&&this.scene.sound.play("switcher"),this.scene.events.emit("MultiSwitcher::activate",this.group,this.num)}}!function(e,t,s,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(a=(o<3?r(a):o>3?r(t,s,a):r(t,s))||a);o>3&&a&&Object.defineProperty(t,s,a)}([n(500)],b.prototype,"activate",null);class S extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,r,o){var a;super(e,t,s,"tp_orange"),this.group=i,this.num=r,this.close=o,this.collidersGroup=[],this.oppositeMultiTimeTeleporters=[],this._alive=!0,e.add.existing(this),this.scene.physics.world.enable(this),this.setImmovable(!0),this.hasFx=null===(a=this.scene.store.get("fx"))||void 0===a||a,this.create()}get alive(){return this._alive}set alive(e){this._alive=e}create(){this.scene.events.on("MultiSwitcher::activate",((e,t)=>{this.switch(e,t)})),this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}switch(e,t){if(e===this.group&&t===this.num){const e=this.oppositeMultiTimeTeleporters.find((e=>e.alive)),t=this.oppositeMultiTimeTeleporters.find((e=>!e.alive));e&&e.setToClose(),this.alive?t&&t.setToOpen():this.setToOpen();const s=this.oppositeMultiTimeTeleporters.shift();this.oppositeMultiTimeTeleporters.push(s)}}setToOpen(){this.alive=!0,this.setTexture("tp_orange"),this.scene.events.emit("MultiTimeTeleporter::setToOpen",this.group,this.num)}setToClose(){this.alive=!1,this.setTexture("tp_orange_close"),this.collidersGroup.filter((e=>e.active)).forEach((e=>e.destroy()))}addColliders(...e){this.collidersGroup.push(...e)}addOpposites(...e){this.oppositeMultiTimeTeleporters.push(...e)}activate(){this.hasFx&&this.scene.sound.play("tp"),this.scene.events.emit("DoubleTimeTeleporter::activate",{x:this.x,y:this.y},this.getOppositeCoordinates())}getOppositeCoordinates(){const e=this.oppositeMultiTimeTeleporters.find((e=>e.alive))||this.oppositeMultiTimeTeleporters[0],{x:t,y:s}=e;return{x:t,y:s}}}class P extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,r,o){var a;super(e,t,s,i),this.group=r,this.num=o,this._nextTp=0,this._tpRate=500,e.add.existing(this),this.hasFx=null===(a=this.scene.store.get("fx"))||void 0===a||a,this.create()}get nextTp(){return this._nextTp}set nextTp(e){this._nextTp=e}get tpRate(){return this._tpRate}create(){this.scene.events.on("SpatialTeleporter::activate",((e,t,s)=>{this.num===t&&this.group===e&&(this.nextTp=s,this.scene.events.emit("SpatialTeleporter::teleport",{x:this.x,y:this.y}))})),this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}activate(){const e=0===this.num?1:0;this.hasFx&&this.scene.sound.play("door_tp"),this.scene.events.emit("SpatialTeleporter::activate",this.group,e,this.nextTp)}}!function(e,t,s,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(a=(o<3?r(a):o>3?r(t,s,a):r(t,s))||a);o>3&&a&&Object.defineProperty(t,s,a)}([n(500)],P.prototype,"activate",null);class O extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i){var r;super(e,t,s,"past_player","idle-1"),this.player=i,this.isDead=!1,this.isDeadEventEmitted=!1,this.hasFx=!0,this.turnRight=!0,this.turnLeft=!1,this.canDetectPlayer=!1,this.hasDetected=!1,e.add.existing(this),this.scene.physics.world.enable(this),this.setCollideWorldBounds(!0),this.hasFx=null===(r=this.scene.store.get("fx"))||void 0===r||r,this.direction="left",this.setDepth(d.PLAYER),this.create()}create(){this.init(),this.scene.events.emit("PastPlayer::init"),this.initBulletsGroups(),this.anims.create({key:"walk",frames:this.scene.anims.generateFrameNames("past_player",{prefix:"walk-",start:1,end:6}),frameRate:5,repeat:-1}),this.anims.create({key:"death",frames:this.scene.anims.generateFrameNames("past_player",{prefix:"death-",start:1,end:5}),frameRate:5,repeat:0}),this.anims.create({key:"shot",frames:this.scene.anims.generateFrameNames("past_player",{prefix:"shot-",start:1,end:3}),frameRate:5,repeat:0}),this.anims.create({key:"simple_gun_shot",frames:this.scene.anims.generateFrameNames("simple_gun_shot",{prefix:"hits-1-",start:2,end:5}),frameRate:5,repeat:0}),this.anims.create({key:"simple_bullet",frames:this.scene.anims.generateFrameNames("simple_bullet",{prefix:"simple-bullet-",start:1,end:4}),frameRate:5,repeat:-1}),this.scene.events.on("Player::shotBullet",((e,t)=>{this.scene.physics.add.collider(this,e,(()=>{e.destroy(),this.isDead||(this.flipX="left"!==t,this.isDead=!0,this.body.enable=!1,this.hasFx&&this.scene.sound.play("death"),this.anims.play("death",!0),this.setVelocity(0))}),void 0,this)}),this),this.scene.events.on("Player::canDetect",(()=>{this.hasDetected=!1})),this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}update(){if(this.on("animationcomplete",(()=>{this.isDead&&!this.isDeadEventEmitted&&(this.anims.stop(),this.scene.events.emit("PastPlayer::isDead"),this.isDeadEventEmitted=!0)})),!this.isDead){const e=this.calculateDistanceWithPlayer();this.canDetectPlayer=e<150&&this.player.y===this.y,this.canDetectPlayer||(this.hasDetected=!1),!this.hasDetected&&this.canDetectPlayer&&this.detectPlayer()}}calculateDistanceWithPlayer(){const e=this.x-this.player.x,t=this.y-this.player.y,s=Math.sqrt(e*e+t*t);return Math.abs(s)}detectPlayer(){!this.hasDetected&&this.player.x<this.x&&(this.turnLeft=!0,this.turnRight=!1,this.hasDetected=!0,this.scene.time.delayedCall(2e3,(()=>{!this.isDead&&this.canDetectPlayer&&(this.flipX=!0,this.direction="right",this.hasDetected=!1,this.shoot())}))),!this.hasDetected&&this.player.x>this.x&&(this.turnRight=!0,this.turnLeft=!1,this.hasDetected=!0,this.scene.time.delayedCall(2e3,(()=>{!this.isDead&&this.canDetectPlayer&&(this.flipX=!1,this.direction="left",this.shoot(),this.hasDetected=!1)})))}shoot(){this.isDead||(this.anims.play("shot"),this.shotBullnetWithFrameRate())}shotBullnetWithFrameRate(){"right"===this.direction&&this.shotBullet(-500),"left"===this.direction&&this.shotBullet(500)}initBulletsGroups(){this.bullets=this.scene.physics.add.group({defaultKey:"simple_bullet",allowGravity:!1,immovable:!0,frameQuantity:5})}shotBullet(e){this.hasFx&&this.scene.sound.play("simple_gun_shot",{volume:1});const t="right"===this.direction?this.x-12:this.x+12,s=this.scene.add.sprite(t,this.y,"simple_gun_shot");s.anims.play("simple_gun_shot"),this.scene.time.delayedCall(50,(()=>{this.anims.stop(),s.destroy()}));const i=this.bullets.get(this.x,this.y);i.anims.play("simple_bullet"),i.body.velocity.x=e,i.checkWorldBounds=!0,i.outOfBoundsKill=!0,this.scene.events.emit("PastPlayer::shotBullet",i,this.direction),this.scene.time.delayedCall(500,(()=>{this.isDead||(this.anims.stop(),this.setTexture("past_player","idle-1"))}))}init(){this.body.setSize(2)}}!function(e,t,s,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(a=(o<3?r(a):o>3?r(t,s,a):r(t,s))||a);o>3&&a&&Object.defineProperty(t,s,a)}([n(500)],O.prototype,"shotBullnetWithFrameRate",null);var w=function(e,t,s,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(a=(o<3?r(a):o>3?r(t,s,a):r(t,s))||a);return o>3&&a&&Object.defineProperty(t,s,a),a};class _ extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i){var r;super(e,t,s,"player","idle-1"),this.isMovable=!0,this.speedX=180,this.hasFx=!0,this.isDeadEventEmitted=!1,this.isDead=!1,this.isClimbing=!1,this.currentstairsClimbingIndex=0,this.stairsGroup=this.scene.physics.add.staticGroup(),this.stairs=null!=i?i:[],this.hasFx=null===(r=this.scene.store.get("fx"))||void 0===r||r,e.add.existing(this),this.scene.physics.world.enable(this),this.setCollideWorldBounds(!0)}getScene(){return this.scene}create(){this.initCharacs(),this.initKeyboardInputs(),this.initAnimations(),this.initBulletsGroups(),this.initStairs(),this.listenToSpatialTeleporterEvents(),this.listenToDoubleTimeTeleporterEvents(),this.listenToSimpleTimeTeleporterEvents(),this.listenToPastPlayerEvents(),this.listenToStoreEvents()}update(){this.checkForStairsOverlapOut(),this.on("animationcomplete",(()=>{this.isDead&&!this.isDeadEventEmitted&&(this.anims.stop(),this.scene.events.emit("Player::isDead"),this.isDeadEventEmitted=!0)})),this.movePlayer(),this.checkActions()}pause(){this.isMovable=!1}resume(){this.isMovable=!0}listenToPastPlayerEvents(){this.scene.events.on("PastPlayer::shotBullet",((e,t)=>{this.scene.physics.add.collider(this,e,(()=>{e.destroy(),this.isDead||(this.isMovable=!1,this.flipX="right"!==t,this.isDead=!0,this.body.enable=!1,this.hasFx&&this.scene.sound.play("death"),this.anims.play("death",!0),this.setVelocity(0))}),void 0,this)}),this)}checkForStairsOverlapOut(){this.stairsGroup.children.entries.forEach((()=>{this.isClimbing&&this.body.touching.none&&(this.isClimbing=!1,this.currentStairsClimbing=[],this.currentstairsClimbingIndex=0)}))}initStairs(){if(this.scene.physics.add.overlap(this,this.stairsGroup,this.overlapStairs,void 0,this),this.stairs.length>0)for(const e of this.stairs){const t={x:e.x,y:e.y},s=e.polyline[1],i={x:e.x+s.x,y:e.y+s.y},r=new Phaser.Curves.Line(new Phaser.Math.Vector2(t.x,t.y),new Phaser.Math.Vector2(i.x,i.y)),o=this.stairsGroup.create(r.getBounds().x,r.getBounds().y,void 0,void 0,!1);o.setScale(r.getBounds().width/32,r.getBounds().height/32),o.setOrigin(0),o.setDataEnabled(),o.setData("curve",r),o.body.width=r.getBounds().width,o.body.height=r.getBounds().height,this.stairsGroup.refresh()}}overlapStairs(e,t){if(!this.isClimbing){const e=t.getData("curve");this.currentStairsClimbing=e.getSpacedPoints(e.getLength()/7),this.isClimbing=!0}}listenToStoreEvents(){this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}initBulletsGroups(){this.bullets=this.scene.physics.add.group({defaultKey:"simple_bullet",allowGravity:!1,immovable:!0,frameQuantity:5})}initAnimations(){this.anims.create({key:"walk",frames:this.scene.anims.generateFrameNames("player",{prefix:"walk-",start:1,end:6}),frameRate:5,repeat:-1}),this.anims.create({key:"death",frames:this.scene.anims.generateFrameNames("player",{prefix:"death-",start:1,end:5}),frameRate:5,repeat:0}),this.anims.create({key:"shot",frames:this.scene.anims.generateFrameNames("player",{prefix:"shot-",start:1,end:3}),frameRate:5,repeat:-1}),this.anims.create({key:"simple_gun_shot",frames:this.scene.anims.generateFrameNames("simple_gun_shot",{prefix:"hits-1-",start:2,end:5}),frameRate:5,repeat:0}),this.scene.anims.create({key:"simple_bullet",frames:this.scene.anims.generateFrameNames("simple_bullet",{prefix:"simple-bullet-",start:1,end:4}),frameRate:5,repeat:-1})}listenToSimpleTimeTeleporterEvents(){this.scene.events.on("SimpleTimeTeleporter::activate",(({x:e,y:t})=>{this.scene.events.emit("Player::tps"),this.teleportOnCoordinates({x:e,y:t})}))}listenToDoubleTimeTeleporterEvents(){this.scene.events.on("DoubleTimeTeleporter::activate",((e,{x:t,y:s})=>{this.scene.events.emit("Player::tps"),this.teleportOnCoordinates({x:t,y:s})}))}listenToSpatialTeleporterEvents(){this.scene.events.on("SpatialTeleporter::teleport",(({x:e,y:t})=>{this.teleportOnCoordinates({x:e,y:t})}))}teleportOnCoordinates({x:e,y:t}){const s="left"===this.direction?e-10:e+10;this.setPosition(s,t),this.scene.events.emit("Player::canDetect")}checkActions(){this.isMovable?(this.enter.isDown?this.enterActivateToTrue():this.enterActivate=!1,this.shot.isDown?this.isShooting=!0:this.isShooting=!1,this.isShooting&&(this.anims.play("shot"),this.shotBulletWithRate())):(this.enterActivate=!1,this.isShooting=!1)}enterActivateToTrue(){this.enterActivate=!0}shotBulletWithRate(){"left"===this.direction&&this.shotBullet(-500),"right"===this.direction&&this.shotBullet(500)}shotBullet(e){this.hasFx&&this.scene.sound.play("simple_gun_shot",{volume:1});const t="left"===this.direction?this.x-12:this.x+12,s=this.scene.add.sprite(t,this.y,"simple_gun_shot");this.anims.play("simple_gun_shot"),this.scene.time.delayedCall(50,(()=>{this.anims.stop(),s.destroy()}));const i=this.bullets.get(this.x,this.y);i.anims.play("simple_bullet"),i.body.velocity.x=e,i.checkWorldBounds=!0,i.outOfBoundsKill=!0,this.scene.events.emit("Player::shotBullet",i,this.direction)}initCharacs(){this.body.setSize(2),this.setDepth(d.PLAYER),this.direction="right"}initKeyboardInputs(){this.left=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Q),this.right=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),this.enter=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER),this.shot=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SHIFT)}intersectObjects(e,t){return(0,Phaser.Geom.Intersects.LineToRectangle)(t,e.getBounds())}movePlayer(){this.isMovable?(this.left.isDown?this.goLeft=!0:this.goLeft=!1,this.right.isDown?this.goRight=!0:this.goRight=!1,this.isShooting?this.setVelocityX(0):(this.goLeft||this.goRight?this.playWalk():this.isDead||this.playIdle(),this.goLeft?(this.flipLeft(),this.isClimbing?this.climbOnLeftDirection():this.setVelocityX(-this.speedX)):this.goRight?(this.flipRight(),this.isClimbing?this.climbOnRightDirection():this.setVelocityX(this.speedX)):this.setVelocityX(0))):this.isDead||this.playIdle()}climbOnRightDirection(){var e;if(this.setVelocityX(this.speedX/2),this.currentstairsClimbingIndex+1<=(null===(e=this.currentStairsClimbing)||void 0===e?void 0:e.length)){const e=this.currentStairsClimbing[this.currentstairsClimbingIndex];this.currentstairsClimbingIndex++,this.setPosition(e.x,e.y)}}climbOnLeftDirection(){var e;if(this.setVelocityX(-this.speedX/2),this.currentstairsClimbingIndex+1<=(null===(e=this.currentStairsClimbing)||void 0===e?void 0:e.length)){const e=this.currentStairsClimbing[this.currentStairsClimbing.length-1-this.currentstairsClimbingIndex];this.currentstairsClimbingIndex++,this.setPosition(e.x,e.y)}}flipRight(){this.flipX=!1,this.direction="right"}flipLeft(){this.flipX=!0,this.direction="left"}playIdle(){this.setVelocityX(0),this.anims.stop(),this.setTexture("player","idle-1")}playWalkWithRate(){this.hasFx&&this.scene.sound.play("walk")}playWalk(){this.anims.play("walk",!0),this.playWalkWithRate()}}w([n(500)],_.prototype,"enterActivateToTrue",null),w([n(500)],_.prototype,"shotBulletWithRate",null),w([n(500)],_.prototype,"playWalkWithRate",null);class L extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,r){var o;super(e,t,s,"switcher_green"),this.group=i,this.num=r,e.add.existing(this),this.hasFx=null===(o=this.scene.store.get("fx"))||void 0===o||o,this.create()}create(){this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}activate(){this.hasFx&&this.scene.sound.play("switcher"),this.scene.events.emit("SimpleSwitcher::activate",this.group)}}!function(e,t,s,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(a=(o<3?r(a):o>3?r(t,s,a):r(t,s))||a);o>3&&a&&Object.defineProperty(t,s,a)}([n(500)],L.prototype,"activate",null);class B extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i){var r;super(e,t,s,"tp_green"),this.group=i,this.alive=!0,e.add.existing(this),this.scene.physics.world.enable(this),this.setImmovable(!0),this.hasFx=null===(r=this.scene.store.get("fx"))||void 0===r||r,this.create()}create(){this.scene.events.on("SimpleSwitcher::activate",(e=>{this.switch(e)})),this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}switch(e){this.group===e&&(this.alive?(this.alive=!1,this.setTexture("tp_green_close"),this.scene.events.emit("SimpleTimeTeleporter::::isClosed",this)):(this.alive=!0,this.setTexture("tp_green"),this.scene.events.emit("SimpleTimeTeleporter::isOpen",this)))}activate(){this.hasFx&&this.scene.sound.play("tp"),this.scene.events.emit("SimpleTimeTeleporter::activate",{x:this.x,y:this.y})}}class E{constructor(e,t,s){this.scene=e,this.x=t,this.y=s}get box(){return this.textBox}start(e){const t=1199753;this.textBox=this.scene.rexUI.add.textBox({x:this.x-18,y:this.y-60,background:this.createSpeechBubbleShape(this.scene,16777215,t),icon:this.scene.rexUI.add.roundRectangle(0,0,2,2,20,t),text:this.getBBcodeText(this.scene,425,600,425,100),action:this.scene.add.image(0,0,"nextPage").setTint(t).setVisible(!1),space:{left:20,right:20,top:20,bottom:20,icon:10,text:10}}).setOrigin(0).layout();const s=this.textBox;this.scene.input.keyboard.on("keydown-ENTER",(()=>{this.textBox.isTyping?this.textBox.stop(!0):this.textBox.isLastPage?this.destroy():this.textBox.typeNextPage()})),this.scene.input.keyboard.on("keydown-ESC",(()=>{this.destroy()})),this.textBox.setDepth(d.TEXT_BOX).setInteractive().on("pageend",(()=>{const e=s.getElement("action");s.isLastPage&&e.setTexture("dialogEnd").setTint(t),e.setVisible(!0),s.resetChildVisibleState(e),e.y-=30,this.scene.tweens.add({targets:e,y:"+=30",ease:"Bounce",duration:500,repeat:0,yoyo:!1})})),this.textBox.start(e,50)}destroy(){this.scene.input.keyboard.off("keydown-ENTER"),this.scene.input.keyboard.off("keydown-ESC"),this.textBox.destroy(),this.scene.events.emit("MyTextBox::complete")}getBBcodeText(e,t,s,i,r){return e.rexUI.add.BBCodeText(0,0,"",{fixedWidth:i,fixedHeight:r,color:0,fontSize:"20px",wrap:{mode:"word",width:t,height:s},maxLines:4})}createSpeechBubbleShape(e,t,s){return e.rexUI.add.customShapes({create:{lines:1},update:function(){const e=20,i=this.width,r=this.height,o=r-15;this.getShapes()[0].lineStyle(2,s,1).fillStyle(t,1).startAt(20,0).lineTo(i-e,0).arc(i-e,20,e,270,360).lineTo(i,o-e).arc(i-e,o-e,e,0,90).lineTo(60,o).lineTo(50,r).lineTo(40,o).lineTo(20,o).arc(20,o-e,e,90,180).lineTo(0,20).arc(20,20,e,180,270).close()}})}}class D extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"exit"),e.add.existing(this),this.setInteractive(),this.setScrollFactor(0),this.setScale(.5),this.setDepth(d.UI),this.create()}create(){this.on("pointerdown",(()=>{this.activate()})),this.on("pointerover",(()=>{this.scene.sys.canvas.style.cursor="pointer"})),this.on("pointerout",(()=>{this.scene.sys.canvas.style.cursor="default"}))}activate(){this.scene.store.get("fx")&&this.scene.sound.play("switcher"),this.scene.events.emit("ExitButton::exit")}}!function(e,t,s,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(a=(o<3?r(a):o>3?r(t,s,a):r(t,s))||a);o>3&&a&&Object.defineProperty(t,s,a)}([n(500)],D.prototype,"activate",null);class R extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){const i=e.store.get("fx");super(e,t,s,i?"audio_on":"audio_off"),e.add.existing(this),this.setInteractive(),this.setScrollFactor(0),this.setScale(.5),this.setDepth(d.UI),this.create()}create(){this.on("pointerdown",(()=>{this.activate()})),this.on("pointerover",(()=>{this.scene.sys.canvas.style.cursor="pointer"})),this.on("pointerout",(()=>{this.scene.sys.canvas.style.cursor="default"}))}activate(){const e=this.scene.store.get("fx");this.scene.store.set("fx",!e),e||this.setTexture("audio_on"),e&&this.setTexture("audio_off"),e&&this.scene.sound.play("switcher")}}!function(e,t,s,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(a=(o<3?r(a):o>3?r(t,s,a):r(t,s))||a);o>3&&a&&Object.defineProperty(t,s,a)}([n(500)],R.prototype,"activate",null);class C extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){const i=e.store.get("music");super(e,t,s,i?"music_on":"music_off"),e.add.existing(this),this.setInteractive(),this.setScrollFactor(0),this.setScale(.5),this.setDepth(d.UI),this.create()}create(){this.on("pointerdown",(()=>{this.activate()})),this.on("pointerover",(()=>{this.scene.sys.canvas.style.cursor="pointer"})),this.on("pointerout",(()=>{this.scene.sys.canvas.style.cursor="default"}))}activate(){const e=this.scene.store.get("music");this.scene.store.set("music",!e),e||this.setTexture("music_on"),e&&this.setTexture("music_off"),this.scene.store.get("fx")&&this.scene.sound.play("switcher")}}!function(e,t,s,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(a=(o<3?r(a):o>3?r(t,s,a):r(t,s))||a);o>3&&a&&Object.defineProperty(t,s,a)}([n(500)],C.prototype,"activate",null);class I extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"reset"),e.add.existing(this),this.setInteractive(),this.setScrollFactor(0),this.setScale(.5),this.setDepth(d.UI),this.create()}create(){this.on("pointerdown",(()=>{this.activate()})),this.on("pointerover",(()=>{this.scene.sys.canvas.style.cursor="pointer"})),this.on("pointerout",(()=>{this.scene.sys.canvas.style.cursor="default"}))}activate(){this.scene.events.emit("ResetButton::reset"),this.scene.store.get("fx")&&this.scene.sound.play("switcher")}}!function(e,t,s,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(a=(o<3?r(a):o>3?r(t,s,a):r(t,s))||a);o>3&&a&&Object.defineProperty(t,s,a)}([n(500)],I.prototype,"activate",null);class j{constructor(e,t,s){this.scene=e,this.x=t,this.y=s;const i=e.store.get("score");this.score=null!=i?i:0,this.create()}create(){this.updatetext(),this.scene.events.on("Player::tps",(()=>{this.score++,this.scene.store.set("score",this.score),this.updatetext()}))}updatetext(){this.text&&this.text.destroy(),this.text=this.scene.add.text(Math.round(this.x),Math.round(this.y-30),"SCORE:"+this.score,{fontFamily:"Pixels",align:"left"}).setScale(1).setFontSize(30).setResolution(10).setOrigin(.5,.5).setColor("white").setScrollFactor(0).setDepth(d.UI)}}class G{constructor(e){new D(e,30,30),new I(e,80,30),new C(e,130,30),new R(e,180,30),new j(e,280,64)}}class F extends Phaser.Scene{constructor(e,t,s){super({key:e}),this.nextScene=t,this.tilesetKey=s,this.dialogs=new Map,this.isDialogLaunched=!1,this.nextActivability=0,this.activabilityRate=500,this.key=e}create(){var e,t,s;this.removeEvents(),this.hasFx=null===(e=this.store.get("fx"))||void 0===e||e,this.hasMusic=null===(t=this.store.get("music"))||void 0===t||t,this.currentScore=null!==(s=this.store.get("score"))&&void 0!==s?s:0,this.musicHasBeenPlayed=!1,this.platformCollidersGroup=this.physics.add.staticGroup(),this.ballGroup=this.add.group(),this.spatialTeleportersGroup=this.add.group(),this.simpleTimeTeleporterGroup=this.add.group(),this.simpleSwitcherGroup=this.add.group(),this.doubleTimeTeleportersGroup=this.add.group(),this.doubleSwitchersGroup=this.add.group(),this.multiTimeTeleportersGroup=this.add.group(),this.multiSwitchersGroup=this.add.group(),this.initMap(),this.initDoors(),this.initPastPlayers(),this.initTopBarUI(),this.listenToPlayerEvents(),this.listenToPastPlayersEvents(),this.listenToMyTextBoxEvents(),this.launchMusic(),this.initAllowsTutorialsOption(),this.listenToTutorialsSwitcherEvents(),this.listenToResetButtonEvents(),this.listenToExitButtonEvents(),this.listenToFxButtonEvents(),this.listenToMusicButtonEvents(),this.initPlayer(),this.createSpatialTeleporters(),this.createTimeTeleporters(),this.createTimeSwitchers()}update(e,t){this.player.update(),this.pastPlayersGroup.preUpdate(e,t),this.checkForTutorials(),this.checkForLevelEnd(),this.checkForTeleportersActivation()}addDialog(e,t){const{x:s,y:i}=this.tilemap.findObject(c.DIALOGS,(t=>t.properties[0].value===e));this.dialogs.set(JSON.stringify({x:s,y:i}),t)}startDialog(e){if(!this.isDialogLaunched&&this.allowsTutorials){const t=this.cameras.main.worldView.x+25,s=this.cameras.main.worldView.y+this.cameras.main.height/2;this.textBox=new E(this,t,s),this.textBox.start(e),this.player.pause(),this.isDialogLaunched=!0}}initTopBarUI(){new G(this)}removeEvents(){this.events.off("DoubleSwitcher::activate"),this.events.off("DoubleTimeTeleporter::activate"),this.events.off("StartScreen::switchFr"),this.events.off("StartScreen::switchEn"),this.events.off("SpatialTeleporter::teleport"),this.events.off("SpatialTeleporter::activate"),this.events.off("MultiSwitcher::activate"),this.events.off("MultiTimeTeleporter::setToOpen"),this.events.off("TutorialsGame::go"),this.events.off("StartNewGame::go"),this.events.off("ContinueGame::go"),this.events.off("PastPlayer::init"),this.events.off("PastPlayer::isDead"),this.events.off("Player::isDead"),this.events.off("Player::canDetect"),this.events.off("Player::shotBullet"),this.events.off("Player::tps"),this.events.off("PastPlayer::shotBullet"),this.events.off("RedSpatialTeleporter::activate"),this.events.off("SimpleSwitcher::activate"),this.events.off("BaseLevel::End"),this.events.off("SimpleTimeTeleporter::activate"),this.events.off("SimpleTimeTeleporter::isOpen"),this.events.off("SimpleTimeTeleporter::::isClosed"),this.events.off("DoubleTimeTeleporter::isOpen"),this.events.off("SoundSwitcher::fx"),this.events.off("TutorialsSwitcher::tutorials"),this.events.off("Store::lang"),this.events.off("Store::music"),this.events.off("Store::tutorials"),this.events.off("Store::fx"),this.events.off("ExitButton::exit"),this.events.off("ResetButton::reset"),this.events.off("MyTextBox::complete"),this.events.off("DoubleSwitcher::activate"),this.events.off("StartScreen::switchMusic"),this.events.off("StartScreen::switchFx"),this.events.off("StartScreen::switchTutorials")}listenToMusicButtonEvents(){this.events.on("Store::music",(e=>{this.hasMusic=e,e||this.music.pause(),e&&(this.musicHasBeenPlayed&&this.music.resume(),this.musicHasBeenPlayed||this.launchMusic())}))}listenToFxButtonEvents(){this.events.on("Store::fx",(e=>{this.hasFx=e}))}listenToResetButtonEvents(){this.events.on("ResetButton::reset",(()=>{this.store.set("score",this.currentScore),this.music.stop(),this.scene.start(this.key)}))}listenToExitButtonEvents(){this.events.on("ExitButton::exit",(()=>{this.store.set("score",this.currentScore),this.music.stop(),this.scene.start(h.StartScreen)}))}initPlayer(){var e,t;const s=this.tilemap.filterObjects(c.STAIRS_DETECTION,(e=>e.name===l.STAIRS_LINE));this.start=this.tilemap.findObject(c.PLAYER,(e=>e.name===l.START)),this.end=this.tilemap.findObject(c.PLAYER,(e=>e.name===l.END)),this.player=new _(this,(null===(e=this.start)||void 0===e?void 0:e.x)||0,(null===(t=this.start)||void 0===t?void 0:t.y)||0,s),this.player.create(),this.cameras.main.startFollow(this.player),this.cameras.main.setLerp(.1,.1),this.physics.add.collider(this.player,[this.groundLayer,this.platformsLayer]),this.physics.add.collider(this.player,this.platformCollidersGroup),this.stairsLayer&&this.physics.add.collider(this.player,this.stairsLayer)}createTimeTeleporters(){const e=this.tilemap.getObjectLayer(c.TIME_TELEPORTERS);if(!e)return;const t=e.objects;if(0!==t.length){for(const e of t){const t=this.utils.getPropertiesAsObject(e),{group:s,num:i}=t;switch(t.type){case"simple":{const t=new B(this,(null==e?void 0:e.x)||0,(null==e?void 0:e.y)||0,s);this.simpleTimeTeleporterGroup.add(t),this.physics.add.collider(t,[this.groundLayer,this.platformsLayer]);break}case"double":{const t=new T(this,(null==e?void 0:e.x)||0,(null==e?void 0:e.y)||0,s,i);this.doubleTimeTeleportersGroup.add(t),this.physics.add.collider(t,[this.groundLayer,this.platformsLayer]);const r=this.utils.findObjectOnGroup(this.doubleTimeTeleportersGroup,(e=>e.group===t.group&&e.num!==t.num));r&&(t.addOpposite(r),r.addOpposite(t));break}case"multi":{const{close:r}=t,o=new S(this,(null==e?void 0:e.x)||0,(null==e?void 0:e.y)||0,s,i,r);this.multiTimeTeleportersGroup.add(o),this.physics.add.collider(o,[this.groundLayer,this.platformsLayer]);break}}}this.initCollidersForSimpleTimeTeleporters(),this.initCollidersForDoubleTimeTeleporters(),this.utils.iterateOnGroup(this.multiTimeTeleportersGroup,(e=>{this.initCollidersForMultiTimeTeleporter(e.group,e.num)})),this.initMultiTimeTeleportersOpposites(),this.closeMultiTimeTeleporters(),this.events.on("SimpleTimeTeleporter::isOpen",(e=>{this.simpleTimeTeleporterGroup.add(e)})),this.events.on("SimpleTimeTeleporter::::isClosed",(e=>{this.simpleTimeTeleporterGroup.remove(e)})),this.events.on("DoubleTimeTeleporter::isOpen",(e=>{this.doubleTimeTeleportersGroup.add(e)})),this.events.on("DoubleTimeTeleporter::isClosed",(e=>{this.doubleTimeTeleportersGroup.remove(e)})),this.events.on("MultiTimeTeleporter::setToOpen",((e,t)=>{this.initCollidersForMultiTimeTeleporter(e,t)}))}}initMultiTimeTeleportersOpposites(){this.utils.iterateOnGroup(this.multiTimeTeleportersGroup,(e=>{this.utils.iterateOnGroup(this.multiTimeTeleportersGroup,(t=>{t.group===e.group&&t.num!==e.num&&e.addOpposites(t)}))}))}initCollidersForDoubleTimeTeleporters(){this.physics.add.collider(this.player,this.doubleTimeTeleportersGroup,((e,t)=>{this.utils.shakeOnTpCollision();const s=t;s.activate();const i="left"===this.player.direction?-20:20,r=new O(this,s.x-i,s.y,this.player);this.pastPlayersGroup.add(r)})),this.physics.add.collider(this.doubleTimeTeleportersGroup,this.ballGroup,((e,t)=>{t.destroy()})),this.physics.add.collider(this.doubleTimeTeleportersGroup,this.pastPlayersGroup,((e,t)=>{const s=t.body.gameObject.x,i="left"===this.player.direction?-20:20;t.body.gameObject.setX(s-i)}))}initCollidersForSimpleTimeTeleporters(){this.physics.add.collider(this.player,this.simpleTimeTeleporterGroup,((e,t)=>{this.utils.shakeOnTpCollision();const s=t;s.activate(),this.events.emit("BaseLevel::firstTp");const i="left"===this.player.direction?-20:20,r=new O(this,s.x-i,s.y,this.player);this.pastPlayersGroup.add(r)})),this.physics.add.collider(this.simpleTimeTeleporterGroup,this.ballGroup,((e,t)=>{t.destroy()})),this.physics.add.collider(this.simpleTimeTeleporterGroup,this.pastPlayersGroup,((e,t)=>{const s=t.body.gameObject.x,i=e.body.gameObject.x;i>s&&t.body.gameObject.setX(s-20),i<s&&t.body.gameObject.setX(s+20)}))}createTimeSwitchers(){const e=this.tilemap.getObjectLayer(c.TIME_SWITCHERS);if(!e)return;const t=e.objects;if(0!==t.length)for(const e of t){const t=this.utils.getPropertiesAsObject(e),{group:s,num:i}=t;switch(t.type){case"simple":{const t=new L(this,(null==e?void 0:e.x)||0,(null==e?void 0:e.y)||0,s,i);this.simpleSwitcherGroup.add(t);break}case"double":{const t=new x(this,(null==e?void 0:e.x)||0,(null==e?void 0:e.y)||0,s,i);this.doubleSwitchersGroup.add(t);break}case"multi":{const t=new b(this,(null==e?void 0:e.x)||0,(null==e?void 0:e.y)||0,s,i);this.multiSwitchersGroup.add(t);break}}}}createSpatialTeleporters(){const e=this.utils.filterObjectsByLayerAndName(c.SPATIAL_TELEPORTERS,l.SPATIAL_DOOR);for(const t of e){const{num:e,group:s,sprite:i}=this.utils.getPropertiesAsObject(t),r=new P(this,(null==t?void 0:t.x)||0,(null==t?void 0:t.y)||0,i,s,e);this.spatialTeleportersGroup.add(r)}}closeMultiTimeTeleporters(){this.utils.iterateOnGroup(this.multiTimeTeleportersGroup,(e=>{e.close&&e.setToClose()}))}initCollidersForMultiTimeTeleporter(e,t){const s=this.utils.findObjectOnGroup(this.multiTimeTeleportersGroup,(s=>s.group===e&&s.num===t));if(!s)return;const i=this.physics.add.collider(this.player,s,((e,t)=>{if(t.alive){this.utils.shakeOnTpCollision(),t.activate();const s="left"===e.direction?-20:20,i=new O(this,t.x-s,t.y,this.player);this.pastPlayersGroup.add(i)}})),r=this.physics.add.collider(s,this.ballGroup,((e,t)=>{s.alive&&t.destroy()})),o=this.physics.add.collider(s,this.pastPlayersGroup,((e,t)=>{const s=t.body.gameObject.x,i="left"===this.player.direction?-20:20;t.body.gameObject.setX(s-i)}));s.addColliders(r,i,o)}checkForTeleportersActivation(){this.utils.iterateOnGroup(this.spatialTeleportersGroup,(e=>{this.utils.intersectObjects(this.player,e)&&this.player.enterActivate&&e.activate()})),this.utils.iterateOnGroup(this.simpleSwitcherGroup,(e=>{this.utils.intersectObjects(this.player,e)&&this.player.enterActivate&&e.activate()})),this.utils.iterateOnGroup(this.doubleSwitchersGroup,(e=>{this.utils.intersectObjects(this.player,e)&&this.player.enterActivate&&e.activate()})),this.utils.iterateOnGroup(this.multiSwitchersGroup,(e=>{this.utils.intersectObjects(this.player,e)&&this.player.enterActivate&&e.activate()}))}checkForLevelEnd(){var e,t,s,i,r;if(this.player.x>((null===(e=this.end)||void 0===e?void 0:e.x)||0)-10&&this.player.x<((null===(t=this.end)||void 0===t?void 0:t.x)||0)+10&&this.player.y>((null===(s=this.end)||void 0===s?void 0:s.y)||0)-10&&this.player.y<((null===(i=this.end)||void 0===i?void 0:i.y)||0)+10&&this.player.enterActivate){const e=this.utils.findObjectOnGroup(this.pastPlayersGroup,(e=>!e.isDead));(null===(r=this.pastPlayersGroup)||void 0===r?void 0:r.getLength())>0&&e?this.time.now>this.nextActivability&&(this.nextActivability=this.time.now+this.activabilityRate,this.hasFx&&this.sound.play("door_close")):(this.events.emit("BaseLevel::End"),this.hasFx&&this.sound.play("end_level"),this.music.stop(),this.scene.start(this.nextScene))}}listenToPastPlayersEvents(){this.events.on("PastPlayer::init",(()=>{this.time.delayedCall(200,(()=>{this.doorExit.close()}))}),this),this.events.on("PastPlayer::shotBullet",(e=>{this.ballGroup.add(e),this.physics.add.collider([this.groundLayer],e,(()=>{e.destroy()}))}),this),this.events.on("PastPlayer::isDead",(()=>{this.utils.findObjectOnGroup(this.pastPlayersGroup,(e=>!e.isDead))||this.time.delayedCall(200,(()=>{this.doorExit.open()}))}),this)}listenToPlayerEvents(){this.events.on("Player::shotBullet",(e=>{this.events.emit("BaseLevel::firstShotGun"),this.ballGroup.add(e),this.physics.add.collider([this.groundLayer],e,(()=>{e.destroy()}))}),this),this.events.on("Player::isDead",(()=>{this.store.set("score",0),alert(this.translate.get(h.BaseLevel,0)),location.reload()}))}listenToMyTextBoxEvents(){this.events.on("MyTextBox::complete",(()=>{this.isDialogLaunched=!1,this.time.delayedCall(500,(()=>{this.player.resume()}))}),this)}initDoors(){const e=this.tilemap.findObject(c.DOORS,(e=>e.name===l.DOOR_START));if(e){const{x:t,y:s}=e;this.doorEntrance=new v(this,t||0,s||0)}const t=this.tilemap.findObject(c.DOORS,(e=>e.name===l.DOOR_END));if(t){const{x:e,y:s}=t;this.doorExit=new f(this,e||0,s||0)}this.doorEntrance&&this.doorExit&&this.physics.add.collider([this.doorEntrance,this.doorExit],[this.groundLayer,this.platformsLayer])}initPastPlayers(){this.pastPlayersGroup=this.add.group(),this.pastPlayersGroup.runChildUpdate=!0,this.physics.add.collider(this.pastPlayersGroup,[this.groundLayer,this.platformsLayer])}initMap(){var e;this.tilemap=this.add.tilemap(this.tilesetKey),this.tileset=this.tilemap.addTilesetImage("tileset","tileset"),this.bckgLayer=this.tilemap.createLayer(c.BACKGROUND,this.tileset,0,0),this.groundLayer=this.tilemap.createLayer(c.GROUND,this.tileset,0,0),this.wallLayer=this.tilemap.createLayer(c.WALL,this.tileset,0,0),this.bridgesLayer=this.tilemap.createLayer(c.BRIDGES,this.tileset,0,0),null===(e=this.bridgesLayer)||void 0===e||e.setDepth(d.BRIDGES),this.wall2Layer=this.tilemap.createLayer(c.WALL2,this.tileset,0,0),this.desksLayer=this.tilemap.createLayer(c.DESKS,this.tileset,0,0),this.platformsLayer=this.tilemap.createLayer(c.PLATFORMS,this.tileset,0,0),this.ceilingLayer=this.tilemap.createLayer(c.CEILING,this.tileset,0,0),this.lightsLayer=this.tilemap.createLayer(c.LIGHTS,this.tileset,0,0),this.stairsLayer=this.tilemap.createLayer(c.STAIRS,this.tileset,0,0),this.stairsLayer&&this.stairsLayer.setCollisionByProperty({collides:!0}),this.groundLayer&&this.groundLayer.setCollisionByProperty({collides:!0}),this.platformsLayer&&this.platformsLayer.setCollisionByProperty({collides:!0}),this.cameras.main.setBounds(0,0,this.tilemap.widthInPixels,this.tilemap.heightInPixels),this.physics.world.setBounds(0,0,this.tilemap.widthInPixels,this.tilemap.heightInPixels),this.utils.init(this.tilemap);const t=this.tilemap.getObjectLayer(c.PLATFORM_COLLIDERS);if(t){const e=t.objects;if(e.length>0)for(const t of e){const e=this.platformCollidersGroup.create(t.x,t.y,void 0,void 0,!1);e.setScale(1),e.setOrigin(.5),e.body.width=32,e.body.height=32,this.platformCollidersGroup.refresh()}}}checkForTutorials(){this.allowsTutorials&&this.dialogs.forEach(((e,t)=>{const{x:s,y:i}=JSON.parse(t);this.isDialogLaunched||this.player.x>(s||0)-10&&this.player.x<(s||0)+10&&this.player.y>(i||0)-10&&this.player.y<(i||0)+10&&(this.startDialog(e),this.dialogs.delete(t))}))}launchMusic(){this.music=this.sound.add("levels"),this.hasMusic&&!this.music.isPlaying&&(this.musicHasBeenPlayed=!0,this.music.play({loop:!0,volume:.1}))}initAllowsTutorialsOption(){const e=this.store.get("tutorials");null!==e&&(this.allowsTutorials=e),null===e&&(this.allowsTutorials=!0)}listenToTutorialsSwitcherEvents(){this.events.on("TutorialsSwitcher::tutorials",(e=>{this.allowsTutorials=e}))}}const A={type:Phaser.AUTO,backgroundColor:"#000",antialias:!1,scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.Center.CENTER_VERTICALLY,width:608,height:352},scene:[m,class extends g{constructor(){super(h.PreloadTutorials,h.Tutorials,"tutorials")}preload(){super.preload()}create(){super.create()}},class extends F{constructor(){super(h.Tutorials,h.StartScreen,"tutorials"),this.endTutorialsMessagePlayed=!1,this.currentScoreFromLevels=0}create(){var e;this.currentScoreFromLevels=null!==(e=this.store.get("score"))&&void 0!==e?e:0,this.store.set("score",0),super.create(),this.addDialog(0,this.translate.get(h.Tutorials,0)),this.addDialog(1,this.translate.get(h.Tutorials,1)),this.addDialog(2,this.translate.get(h.Tutorials,2)),this.addDialog(3,this.translate.get(h.Tutorials,3)),this.addDialog(4,this.translate.get(h.Tutorials,4)),this.addDialog(5,this.translate.get(h.Tutorials,5)),this.addDialog(6,this.translate.get(h.Tutorials,6)),this.addDialog(7,this.translate.get(h.Tutorials,7)),this.events.on("ExitButton::exit",(()=>{this.restoreCurrentScoreFromLevels()})),this.events.on("BaseLevel::End",(()=>{this.restoreCurrentScoreFromLevels()}))}restoreCurrentScoreFromLevels(){this.store.set("score",this.currentScoreFromLevels)}update(e,t){super.update(e,t);const s=this.tilemap.findObject(c.EVENTS,(e=>"end_tutorials"===e.name));!this.endTutorialsMessagePlayed&&s&&this.utils.coordinatesAreNear(s,this.player)&&(this.endTutorialsMessagePlayed=!0,this.player.pause(),alert(this.translate.get(h.Tutorials,8)),this.time.delayedCall(500,(()=>{this.player.resume()})))}},class extends g{constructor(){super(h.PreloadLevel1,h.Level1,"level1")}preload(){super.preload()}create(){super.create()}},class extends F{constructor(){super(h.Level1,h.PreloadLevel2,"level1")}create(){super.create()}update(e,t){super.update(e,t)}},class extends g{constructor(){super(h.PreloadLevel2,h.Level2,"level2")}preload(){super.preload()}create(){super.create()}},class extends F{constructor(){super(h.Level2,h.PreloadLevel3,"level2")}create(){super.create()}update(e,t){super.update(e,t)}},class extends g{constructor(){super(h.PreloadLevel3,h.Level3,"level3")}preload(){super.preload()}create(){super.create()}},class extends F{constructor(){super(h.Level3,h.PreloadLevel4,"level3")}create(){super.create()}update(e,t){super.update(e,t)}},class extends g{constructor(){super(h.PreloadLevel4,h.Level4,"level4")}preload(){super.preload()}create(){super.create()}},class extends F{constructor(){super(h.Level4,h.StartScreen,"level4")}create(){super.create(),this.addDialog(0,this.translate.get(h.Level4,0));const e=this.tilemap.findObject(c.PLAYER,(e=>e.name===l.CORPSE));e&&this.add.sprite(e.x,e.y,"player","death-5"),this.events.on("MyTextBox::complete",(()=>{alert(this.translate.get(h.Level4,1))}))}update(e,t){super.update(e,t)}}],physics:{default:"arcade",arcade:{debug:!1,gravity:{y:500}}},plugins:{scene:[{key:"rexUI",plugin:i.Z,mapping:"rexUI"},{key:"store",plugin:o,mapping:"store"},{key:"translate",plugin:a,mapping:"translate"},{key:"utils",plugin:r,mapping:"utils"}]}};window.addEventListener("load",(()=>{new Phaser.Game(A)}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function i(e){var r=s[e];if(void 0!==r)return r.exports;var o=s[e]={exports:{}};return t[e].call(o.exports,o,o.exports,i),o.exports}i.m=t,e=[],i.O=(t,s,r,o)=>{if(!s){var a=1/0;for(c=0;c<e.length;c++){for(var[s,r,o]=e[c],n=!0,h=0;h<s.length;h++)(!1&o||a>=o)&&Object.keys(i.O).every((e=>i.O[e](s[h])))?s.splice(h--,1):(n=!1,o<a&&(a=o));if(n){e.splice(c--,1);var l=r();void 0!==l&&(t=l)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[s,r,o]},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var r,o,[a,n,h]=s,l=0;if(a.some((t=>0!==e[t]))){for(r in n)i.o(n,r)&&(i.m[r]=n[r]);if(h)var c=h(i)}for(t&&t(s);l<a.length;l++)o=a[l],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(c)},s=self.webpackChunkparadoxe=self.webpackChunkparadoxe||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.O(void 0,[216],(()=>i(876)));var r=i.O(void 0,[216],(()=>i(204)));r=i.O(r)})();