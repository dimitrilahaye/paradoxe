/*! For license information please see main.595b55d0848ab18abd8a.bundle.js.LICENSE.txt */
(()=>{var e,t={108:(e,t,s)=>{"use strict";s(260);var i,a,r,o=s(227);!function(e){e.BaseLevel="BaseLevel",e.PreloadStartScreen="PreloadStartScreen",e.StartScreen="StartScreen",e.PreloadTutorials="PreloadTutorials",e.Tutorials="Tutorials",e.PreloadLevel0="PreloadLevel0",e.Level0="Level0",e.PreloadLevel1="PreloadLevel1",e.Level1="Level1",e.PreloadLevel2="PreloadLevel2",e.Level2="Level2",e.PreloadLevel3="PreloadLevel3",e.Level3="Level3",e.PreloadLevel4="PreloadLevel4",e.Level4="Level4",e.PreloadLevel5="PreloadLevel5",e.Level5="Level5",e.PreloadLevel6="PreloadLevel6",e.Level6="Level6",e.PreloadLevel7="PreloadLevel7",e.Level7="Level7",e.PreloadLevel8="PreloadLevel8",e.Level8="Level8"}(i||(i={}));class l extends Phaser.Scene{constructor(e,t,s){super({key:e}),this.nextScene=t,this.tilesetKey=s,this.key=e}preload(){const e=this.add.graphics(),t=this.add.graphics();t.fillStyle(2236962,.8),t.fillRect(140,240,320,50);const s=this.cameras.main.width,i=this.cameras.main.height,a=this.make.text({x:s/2,y:i/2-50,text:"Loading...",style:{font:"20px Pixels",color:"#ffffff"}});a.setOrigin(.5,.5);const r=this.make.text({x:s/2,y:i/2-30,text:"0%",style:{font:"18px Pixels",color:"#ffffff"}});r.setOrigin(.5,.5);const o=this.make.text({x:s/2,y:i/2+70,text:"",style:{font:"18px Pixels",color:"#ffffff"}});o.setOrigin(.5,.5),this.load.on("progress",(t=>{e.clear(),e.fillStyle(16777215,1),e.fillRect(140,240,300*t,30),r.setText(parseInt((100*t).toString())+"%")})),this.load.on("fileprogress",(e=>{const t=e.src.split("/"),s=t[t.length-1];o.setText("Loading asset: "+s)})),this.load.on("complete",(()=>{o.destroy(),r.destroy(),a.destroy(),e.destroy(),t.destroy(),this.load.off("progress"),this.load.off("fileprogress"),this.load.off("complete")})),this.load.json("translations","assets/json/options/translations.json"),this.load.scenePlugin({key:"rexUI",sceneKey:"rexUI"}),this.load.image("nextPage","assets/img/ui/arrow-down-left.png"),this.load.image("dialogEnd","assets/img/ui/cancel.png"),this.load.audio("death","assets/sounds/death.wav"),this.load.audio("door_tp","assets/sounds/door_tp.wav"),this.load.audio("simple_gun_shot","assets/sounds/simple_gun_shot.wav"),this.load.audio("levels","assets/sounds/levels.wav"),this.load.audio("tp","assets/sounds/tp.wav"),this.load.audio("walk","assets/sounds/walk.wav"),this.load.audio("switcher","assets/sounds/switcher.wav"),this.load.audio("door_open","assets/sounds/door_open.wav"),this.load.audio("door_close","assets/sounds/door_close.wav"),this.load.audio("end_level","assets/sounds/end_level.wav"),this.load.image("tileset","assets/img/tileset.png"),this.load.image("door_start","assets/img/objects/door_start.png"),this.load.image("door_end_open","assets/img/objects/door_end_open.png"),this.load.image("door_end_close","assets/img/objects/door_end_close.png"),this.load.image("door_tp_red","assets/img/objects/door_tp_red.png"),this.load.image("door_tp_green","assets/img/objects/door_tp_green.png"),this.load.image("door_tp_full_red","assets/img/objects/door_tp_full_red.png"),this.load.image("door_tp_full_green","assets/img/objects/door_tp_full_green.png"),this.load.image("tp_red","assets/img/objects/tp_red.png"),this.load.image("tp_red_close","assets/img/objects/tp_red_close.png"),this.load.image("tp_orange","assets/img/objects/tp_orange.png"),this.load.image("tp_orange_close","assets/img/objects/tp_orange_close.png"),this.load.image("tp_green","assets/img/objects/tp_green.png"),this.load.image("tp_green_close","assets/img/objects/tp_green_close.png"),this.load.image("switcher_red","assets/img/objects/switcher_red.png"),this.load.image("switcher_green","assets/img/objects/switcher_green.png"),this.load.image("switcher_orange","assets/img/objects/switcher_orange.png"),this.load.image("reset","assets/img/ui/return.png"),this.load.image("exit","assets/img/ui/exit.png"),this.load.image("audio_on","assets/img/ui/audioOn.png"),this.load.image("audio_off","assets/img/ui/audioOff.png"),this.load.image("music_on","assets/img/ui/musicOn.png"),this.load.image("music_off","assets/img/ui/musicOff.png"),this.load.tilemapTiledJSON(this.tilesetKey,`assets/json/levels/${this.tilesetKey}.json`),this.load.atlas("player","assets/img/chars/player_atlas.png","assets/json/chars/player_atlas.json"),this.load.atlas("past_player","assets/img/chars/past_player_atlas.png","assets/json/chars/past_player_atlas.json"),this.load.atlas("simple_bullet","assets/img/objects/simple_bullet_atlas.png","assets/json/objects/simple_bullet_atlas.json"),this.load.atlas("simple_gun_shot","assets/img/particles/simple_gun_shot.png","assets/json/particles/simple_gun_shot.json")}create(){this.key!==i.PreloadTutorials&&this.store.set("level",this.key),this.scene.start(this.nextScene)}}!function(e){e.DOOR_START="start",e.CORPSE="corpse",e.DOOR_END="end",e.START="start",e.END="end",e.DIALOG="dialog",e.STAIRS_DETECTION="stairs_detection",e.STAIRS_LINE="stairs_line",e.DOOR_TP_GREEN_1="door_tp_green_1",e.DOOR_TP_GREEN_2="door_tp_green_2",e.DOOR_TP_RED_1="door_tp_red_1",e.DOOR_TP_RED_2="door_tp_red_2",e.TP_SIMPLE="tp_simple",e.TP_DOUBLE_1="tp_double_1",e.TP_DOUBLE_2="tp_double_2",e.TP_MULTI_1="tp_multi_1",e.TP_MULTI_2="tp_multi_2",e.TP_MULTI_3="tp_multi_3",e.SWITCHER_SIMPLE="switcher_simple",e.SWITCHER_DOUBLE="switcher_double",e.SWITCHER_MULTI_1="switcher_multi_1",e.SWITCHER_MULTI_2="switcher_multi_2",e.SWITCHER_MULTI_3="switcher_multi_3"}(a||(a={})),function(e){e.EVENTS="events",e.DIALOGS="dialogs",e.TELEPORTERS_SPATIAL="teleporters_spatial",e.PLAYER="player",e.DOORS="doors",e.STAIRS_DETECTION="stairs_detection",e.TELEPORTERS_MULTI="teleporters_multi",e.SWITCHERS_MULTI="switchers_multi",e.TELEPORTERS_SIMPLE="teleporters_simple",e.SWITCHERS_SIMPLE="switchers_simple",e.TELEPORTERS_DOUBLE="teleporters_double",e.SWITCHERS_DOUBLE="switchers_double",e.CEILING="ceiling",e.LIGHTS="lights",e.OPTIONS="options",e.PLATFORMS="platforms",e.DESKS="desks",e.WALL2="wall2",e.WALL="wall",e.TP="tp",e.GROUND="ground",e.BACKGROUND="background",e.STAIRS="stairs",e.TITLE="title"}(r||(r={}));class n extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"door_start"),e.add.existing(this)}}class h extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){var i;super(e,t,s,"door_end_open"),e.add.existing(this),this.hasFx=null===(i=this.scene.store.get("fx"))||void 0===i||i,this.create()}create(){this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}open(){this.setTexture("door_end_open"),this.hasFx&&this.scene.sound.play("door_open")}close(){this.setTexture("door_end_close"),this.hasFx&&this.scene.sound.play("door_close")}}class c extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){var i;super(e,t,s,"switcher_red"),this.nextActivability=0,this.activabilityRate=500,e.add.existing(this),this.hasFx=null===(i=this.scene.store.get("fx"))||void 0===i||i,this.create()}create(){this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}activate(){this.scene.time.now>this.nextActivability&&(this.nextActivability=this.scene.time.now+this.activabilityRate,this.hasFx&&this.scene.sound.play("switcher"),this.scene.events.emit("DoubleSwitcher::activate"))}}class d extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){var i;super(e,t,s,"tp_red"),this.collidersGroup=[],this.alive=!0,e.add.existing(this),this.scene.physics.world.enable(this),this.setImmovable(!0),this.hasFx=null===(i=this.scene.store.get("fx"))||void 0===i||i,this.create()}create(){this.scene.events.on("DoubleSwitcher::activate",(()=>{this.alive&&(this.alive=!1,this.setTexture("tp_red_close"),this.collidersGroup.forEach((e=>this.scene.physics.world.removeCollider(e))))})),this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}addColliders(...e){this.collidersGroup.push(...e)}addOpposite(e){this.oppositeDoubleTimeTeleporter=e}activate(){this.hasFx&&this.scene.sound.play("tp"),this.scene.events.emit("DoubleTimeTeleporter::activate",{x:this.x,y:this.y},this.getOppositeCoordinates())}getOppositeCoordinates(){const{x:e,y:t}=this.oppositeDoubleTimeTeleporter;return{x:e,y:t}}}class p extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i){var a;super(e,t,s,"switcher_orange"),this.nextActivability=0,this.activabilityRate=500,e.add.existing(this),this.num=i,this.hasFx=null===(a=this.scene.store.get("fx"))||void 0===a||a,this.create()}create(){this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}activate(){this.scene.time.now>this.nextActivability&&(this.nextActivability=this.scene.time.now+this.activabilityRate,this.hasFx&&this.scene.sound.play("switcher"),this.scene.events.emit("MultiSwitcher::activate",this.num))}}class u extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i){var a;super(e,t,s,"tp_orange"),this.collidersGroup=[],this.oppositeMultiTimeTeleporters=[],this._alive=!0,e.add.existing(this),this.scene.physics.world.enable(this),this.setImmovable(!0),this.num=i,this.hasFx=null===(a=this.scene.store.get("fx"))||void 0===a||a,this.create()}get alive(){return this._alive}set alive(e){this._alive=e}get num(){return this._num}set num(e){this._num=e}create(){this.scene.events.on("MultiSwitcher::activate",(e=>{if(e===this.num){const e=this.oppositeMultiTimeTeleporters.find((e=>e.alive)),t=this.oppositeMultiTimeTeleporters.find((e=>!e.alive));e&&e.setToClose(),this.alive?t&&t.setToOpen():this.setToOpen();const s=this.oppositeMultiTimeTeleporters.shift();this.oppositeMultiTimeTeleporters.push(s)}})),this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}setToOpen(){this.alive=!0,this.setTexture("tp_orange"),this.scene.events.emit("MultiTimeTeleporter::setToOpen",this.num)}setToClose(){this.alive=!1,this.setTexture("tp_orange_close"),this.collidersGroup.filter((e=>e.active)).forEach((e=>e.destroy()))}addColliders(...e){this.collidersGroup.push(...e)}addOpposites(...e){this.oppositeMultiTimeTeleporters.push(...e)}activate(){this.hasFx&&this.scene.sound.play("tp"),this.scene.events.emit("DoubleTimeTeleporter::activate",{x:this.x,y:this.y},this.getOppositeCoordinates())}getOppositeCoordinates(){const e=this.oppositeMultiTimeTeleporters.find((e=>e.alive))||this.oppositeMultiTimeTeleporters[0],{x:t,y:s}=e;return{x:t,y:s}}}class m extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,a,r){super(e,t,s,i),this.group=a,this.num=r,this._nextTp=0,this._tpRate=500,e.add.existing(this),this.create()}get nextTp(){return this._nextTp}set nextTp(e){this._nextTp=e}get tpRate(){return this._tpRate}create(){this.scene.events.on("SpatialTeleporter::activate",((e,t,s)=>{this.num===t&&this.group===e&&(this.nextTp=s,this.scene.events.emit("SpatialTeleporter::teleport",{x:this.x,y:this.y}))})),this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}activate(){if(this.scene.time.now>this.nextTp){this.nextTp=this.scene.time.now+this.tpRate;const e=0===this.num?1:0;this.hasFx&&this.scene.sound.play("door_tp"),this.scene.events.emit("SpatialTeleporter::activate",this.group,e,this.nextTp)}}}class y extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i){var a;super(e,t,s,"past_player","idle-1"),this.player=i,this.isDead=!1,this.isDeadEventEmitted=!1,this.nextFire=0,this.fireRate=500,this.hasFx=!0,this.turnRight=!0,this.turnLeft=!1,this.canDetectPlayer=!1,this.hasDetected=!1,e.add.existing(this),this.scene.physics.world.enable(this),this.setCollideWorldBounds(!0),this.hasFx=null===(a=this.scene.store.get("fx"))||void 0===a||a,this.direction="left",this.create()}create(){this.init(),this.scene.events.emit("PastPlayer::init"),this.initBulletsGroups(),this.anims.create({key:"walk",frames:this.scene.anims.generateFrameNames("past_player",{prefix:"walk-",start:1,end:6}),frameRate:5,repeat:-1}),this.anims.create({key:"death",frames:this.scene.anims.generateFrameNames("past_player",{prefix:"death-",start:1,end:5}),frameRate:5,repeat:0}),this.anims.create({key:"shot",frames:this.scene.anims.generateFrameNames("past_player",{prefix:"shot-",start:1,end:3}),frameRate:5,repeat:0}),this.anims.create({key:"simple_gun_shot",frames:this.scene.anims.generateFrameNames("simple_gun_shot",{prefix:"hits-1-",start:2,end:5}),frameRate:5,repeat:0}),this.anims.create({key:"simple_bullet",frames:this.scene.anims.generateFrameNames("simple_bullet",{prefix:"simple-bullet-",start:1,end:4}),frameRate:5,repeat:-1}),this.scene.events.on("Player::shotBullet",((e,t)=>{this.scene.physics.add.collider(this,e,(()=>{e.destroy(),this.isDead||(this.flipX="left"!==t,this.isDead=!0,this.body.enable=!1,this.hasFx&&this.scene.sound.play("death"),this.anims.play("death",!0),this.setVelocity(0))}),void 0,this)}),this),this.scene.events.on("Player::canDetect",(()=>{this.hasDetected=!1})),this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}update(){if(this.on("animationcomplete",(()=>{this.isDead&&!this.isDeadEventEmitted&&(this.anims.stop(),this.scene.events.emit("PastPlayer::isDead"),this.isDeadEventEmitted=!0)})),!this.isDead){const e=this.calculateDistanceWithPlayer();this.canDetectPlayer=e<150&&this.player.y===this.y,this.canDetectPlayer||(this.hasDetected=!1),!this.hasDetected&&this.canDetectPlayer&&this.detectPlayer()}}calculateDistanceWithPlayer(){const e=this.x-this.player.x,t=this.y-this.player.y,s=Math.sqrt(e*e+t*t);return Math.abs(s)}detectPlayer(){!this.hasDetected&&this.player.x<this.x&&(this.turnLeft=!0,this.turnRight=!1,this.hasDetected=!0,this.scene.time.delayedCall(2e3,(()=>{!this.isDead&&this.canDetectPlayer&&(this.flipX=!0,this.direction="right",this.hasDetected=!1,this.shoot())}))),!this.hasDetected&&this.player.x>this.x&&(this.turnRight=!0,this.turnLeft=!1,this.hasDetected=!0,this.scene.time.delayedCall(2e3,(()=>{!this.isDead&&this.canDetectPlayer&&(this.flipX=!1,this.direction="left",this.shoot(),this.hasDetected=!1)})))}shoot(){this.isDead||(this.anims.play("shot"),this.scene.time.now>this.nextFire&&(this.nextFire=this.scene.time.now+this.fireRate,"right"===this.direction&&this.shotBullet(-500),"left"===this.direction&&this.shotBullet(500)))}initBulletsGroups(){this.bullets=this.scene.physics.add.group({defaultKey:"simple_bullet",allowGravity:!1,immovable:!0,frameQuantity:5})}shotBullet(e){this.hasFx&&this.scene.sound.play("simple_gun_shot",{volume:1});const t="right"===this.direction?this.x-12:this.x+12,s=this.scene.add.sprite(t,this.y,"simple_gun_shot");s.anims.play("simple_gun_shot"),this.scene.time.delayedCall(50,(()=>{this.anims.stop(),s.destroy()}));const i=this.bullets.get(this.x,this.y);i.anims.play("simple_bullet"),i.body.velocity.x=e,i.checkWorldBounds=!0,i.outOfBoundsKill=!0,this.scene.events.emit("PastPlayer::shotBullet",i,this.direction),this.scene.time.delayedCall(500,(()=>{this.isDead||(this.anims.stop(),this.setTexture("past_player","idle-1"))}))}init(){this.body.setSize(2)}}class v extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i){var a;super(e,t,s,"player","idle-1"),this.isMovable=!0,this.speedX=180,this.nextFire=0,this.fireRate=500,this.nextWalkSound=0,this.walkSoundRate=500,this.nextActivability=0,this.activabilityRate=500,this.hasFx=!0,this.isDeadEventEmitted=!1,this.isDead=!1,this.isClimbing=!1,this.currentstairsClimbingIndex=0,this.stairsGroup=this.scene.physics.add.staticGroup(),this.stairs=null!=i?i:[],this.hasFx=null===(a=this.scene.store.get("fx"))||void 0===a||a,e.add.existing(this),this.scene.physics.world.enable(this),this.setCollideWorldBounds(!0)}create(){this.initCharacs(),this.initKeyboardInputs(),this.initAnimations(),this.initBulletsGroups(),this.initStairs(),this.listenToSpatialTeleporterEvents(),this.listenToDoubleTimeTeleporterEvents(),this.listenToSimpleTimeTeleporterEvents(),this.listenToPastPlayerEvents(),this.listenToStoreEvents()}update(){this.checkForStairsOverlapOut(),this.on("animationcomplete",(()=>{this.isDead&&!this.isDeadEventEmitted&&(this.anims.stop(),this.scene.events.emit("Player::isDead"),this.isDeadEventEmitted=!0)})),this.movePlayer(),this.checkActions()}pause(){this.isMovable=!1}resume(){this.isMovable=!0}listenToPastPlayerEvents(){this.scene.events.on("PastPlayer::shotBullet",((e,t)=>{this.scene.physics.add.collider(this,e,(()=>{e.destroy(),this.isDead||(this.isMovable=!1,this.flipX="right"!==t,this.isDead=!0,this.body.enable=!1,this.hasFx&&this.scene.sound.play("death"),this.anims.play("death",!0),this.setVelocity(0))}),void 0,this)}),this)}checkForStairsOverlapOut(){this.stairsGroup.children.entries.forEach((()=>{this.isClimbing&&this.body.touching.none&&(this.isClimbing=!1,this.currentStairsClimbing=[],this.currentstairsClimbingIndex=0)}))}initStairs(){if(this.scene.physics.add.overlap(this,this.stairsGroup,this.overlapStairs,void 0,this),this.stairs.length>0)for(const e of this.stairs){const t={x:e.x,y:e.y},s=e.polyline[1],i={x:e.x+s.x,y:e.y+s.y},a=new Phaser.Curves.Line(new Phaser.Math.Vector2(t.x,t.y),new Phaser.Math.Vector2(i.x,i.y)),r=this.stairsGroup.create(a.getBounds().x,a.getBounds().y,void 0,void 0,!1);r.setScale(a.getBounds().width/32,a.getBounds().height/32),r.setOrigin(0),r.setDataEnabled(),r.setData("curve",a),r.body.width=a.getBounds().width,r.body.height=a.getBounds().height,this.stairsGroup.refresh()}}overlapStairs(e,t){if(!this.isClimbing){const e=t.getData("curve");this.currentStairsClimbing=e.getSpacedPoints(e.getLength()/7),this.isClimbing=!0}}listenToStoreEvents(){this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}initBulletsGroups(){this.bullets=this.scene.physics.add.group({defaultKey:"simple_bullet",allowGravity:!1,immovable:!0,frameQuantity:5})}initAnimations(){this.anims.create({key:"walk",frames:this.scene.anims.generateFrameNames("player",{prefix:"walk-",start:1,end:6}),frameRate:5,repeat:-1}),this.anims.create({key:"death",frames:this.scene.anims.generateFrameNames("player",{prefix:"death-",start:1,end:5}),frameRate:5,repeat:0}),this.anims.create({key:"shot",frames:this.scene.anims.generateFrameNames("player",{prefix:"shot-",start:1,end:3}),frameRate:5,repeat:-1}),this.anims.create({key:"simple_gun_shot",frames:this.scene.anims.generateFrameNames("simple_gun_shot",{prefix:"hits-1-",start:2,end:5}),frameRate:5,repeat:0}),this.scene.anims.create({key:"simple_bullet",frames:this.scene.anims.generateFrameNames("simple_bullet",{prefix:"simple-bullet-",start:1,end:4}),frameRate:5,repeat:-1})}listenToSimpleTimeTeleporterEvents(){this.scene.events.on("SimpleTimeTeleporter::activate",(({x:e,y:t})=>{this.scene.events.emit("Player::tps"),this.teleportOnCoordinates({x:e,y:t})}))}listenToDoubleTimeTeleporterEvents(){this.scene.events.on("DoubleTimeTeleporter::activate",((e,{x:t,y:s})=>{this.scene.events.emit("Player::tps"),this.teleportOnCoordinates({x:t,y:s})}))}listenToSpatialTeleporterEvents(){this.scene.events.on("SpatialTeleporter::teleport",(({x:e,y:t})=>{this.teleportOnCoordinates({x:e,y:t})}))}teleportOnCoordinates({x:e,y:t}){const s="left"===this.direction?e-10:e+10;this.setPosition(s,t),this.scene.events.emit("Player::canDetect")}checkActions(){this.isMovable?(this.enter.isDown?this.scene.time.now>this.nextActivability&&(this.nextActivability=this.scene.time.now+this.activabilityRate,this.enterActivate=!0):this.enterActivate=!1,this.shot.isDown?this.isShooting=!0:this.isShooting=!1,this.isShooting&&(this.anims.play("shot"),this.scene.time.now>this.nextFire&&(this.nextFire=this.scene.time.now+this.fireRate,"left"===this.direction&&this.shotBullet(-500),"right"===this.direction&&this.shotBullet(500)))):(this.enterActivate=!1,this.isShooting=!1)}shotBullet(e){this.hasFx&&this.scene.sound.play("simple_gun_shot",{volume:1});const t="left"===this.direction?this.x-12:this.x+12,s=this.scene.add.sprite(t,this.y,"simple_gun_shot");this.anims.play("simple_gun_shot"),this.scene.time.delayedCall(50,(()=>{this.anims.stop(),s.destroy()}));const i=this.bullets.get(this.x,this.y);i.anims.play("simple_bullet"),i.body.velocity.x=e,i.checkWorldBounds=!0,i.outOfBoundsKill=!0,this.scene.events.emit("Player::shotBullet",i,this.direction)}initCharacs(){this.body.setSize(2),this.direction="right"}initKeyboardInputs(){this.left=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.LEFT),this.right=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.RIGHT),this.enter=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER),this.shot=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE)}intersectObjects(e,t){return(0,Phaser.Geom.Intersects.LineToRectangle)(t,e.getBounds())}movePlayer(){this.isMovable?(this.left.isDown?this.goLeft=!0:this.goLeft=!1,this.right.isDown?this.goRight=!0:this.goRight=!1,this.isShooting?this.setVelocityX(0):(this.goLeft||this.goRight?this.playWalk():this.isDead||this.playIdle(),this.goLeft?(this.flipLeft(),this.isClimbing?this.climbOnLeftDirection():this.setVelocityX(-this.speedX)):this.goRight?(this.flipRight(),this.isClimbing?this.climbOnRightDirection():this.setVelocityX(this.speedX)):this.setVelocityX(0))):this.isDead||this.playIdle()}climbOnRightDirection(){var e;if(this.setVelocityX(this.speedX/2),this.currentstairsClimbingIndex+1<=(null===(e=this.currentStairsClimbing)||void 0===e?void 0:e.length)){const e=this.currentStairsClimbing[this.currentstairsClimbingIndex];this.currentstairsClimbingIndex++,this.setPosition(e.x,e.y)}}climbOnLeftDirection(){var e;if(this.setVelocityX(-this.speedX/2),this.currentstairsClimbingIndex+1<=(null===(e=this.currentStairsClimbing)||void 0===e?void 0:e.length)){const e=this.currentStairsClimbing[this.currentStairsClimbing.length-1-this.currentstairsClimbingIndex];this.currentstairsClimbingIndex++,this.setPosition(e.x,e.y)}}flipRight(){this.flipX=!1,this.direction="right"}flipLeft(){this.flipX=!0,this.direction="left"}playIdle(){this.setVelocityX(0),this.anims.stop(),this.setTexture("player","idle-1")}playWalk(){this.anims.play("walk",!0),this.scene.time.now>this.nextWalkSound&&(this.nextWalkSound=this.scene.time.now+this.walkSoundRate,this.hasFx&&this.scene.sound.play("walk"))}}class g extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){var i;super(e,t,s,"switcher_green"),this.nextActivability=0,this.activabilityRate=500,e.add.existing(this),this.hasFx=null===(i=this.scene.store.get("fx"))||void 0===i||i,this.create()}create(){this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}activate(){this.scene.time.now>this.nextActivability&&(this.nextActivability=this.scene.time.now+this.activabilityRate,this.hasFx&&this.scene.sound.play("switcher"),this.scene.events.emit("SimpleSwitcher::activate"))}}class T extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){var i;super(e,t,s,"tp_green"),this.collidersGroup=[],this.alive=!0,e.add.existing(this),this.scene.physics.world.enable(this),this.setImmovable(!0),this.hasFx=null===(i=this.scene.store.get("fx"))||void 0===i||i,this.create()}create(){this.scene.events.on("SimpleSwitcher::activate",(()=>{this.alive&&(this.alive=!1,this.setTexture("tp_green_close"),this.collidersGroup.forEach((e=>this.scene.physics.world.removeCollider(e))))})),this.scene.events.on("Store::fx",(e=>{this.hasFx=e}))}addColliders(...e){this.collidersGroup.push(...e)}activate(){this.hasFx&&this.scene.sound.play("tp"),this.scene.events.emit("SimpleTimeTeleporter::activate",{x:this.x,y:this.y})}}class x{constructor(e,t,s){this.scene=e,this.x=t,this.y=s}get box(){return this.textBox}start(e){const t=1199753;this.textBox=this.scene.rexUI.add.textBox({x:this.x-18,y:this.y-60,background:this.createSpeechBubbleShape(this.scene,16777215,t),icon:this.scene.rexUI.add.roundRectangle(0,0,2,2,20,t),text:this.getBBcodeText(this.scene,425,600,425,100),action:this.scene.add.image(0,0,"nextPage").setTint(t).setVisible(!1),space:{left:20,right:20,top:20,bottom:20,icon:10,text:10}}).setOrigin(0).layout();const s=this.textBox;this.scene.input.keyboard.on("keydown-ENTER",(()=>{this.textBox.isTyping?this.textBox.stop(!0):this.textBox.isLastPage?this.destroy():this.textBox.typeNextPage()})),this.scene.input.keyboard.on("keydown-ESC",(()=>{this.destroy()})),this.textBox.setInteractive().on("pageend",(()=>{const e=s.getElement("action");s.isLastPage&&e.setTexture("dialogEnd").setTint(t),e.setVisible(!0),s.resetChildVisibleState(e),e.y-=30,this.scene.tweens.add({targets:e,y:"+=30",ease:"Bounce",duration:500,repeat:0,yoyo:!1})})),this.textBox.start(e,50)}destroy(){this.scene.input.keyboard.off("keydown-ENTER"),this.scene.input.keyboard.off("keydown-ESC"),this.textBox.destroy(),this.scene.events.emit("MyTextBox::complete")}getBBcodeText(e,t,s,i,a){return e.rexUI.add.BBCodeText(0,0,"",{fixedWidth:i,fixedHeight:a,color:0,fontSize:"20px",wrap:{mode:"word",width:t,height:s},maxLines:4})}createSpeechBubbleShape(e,t,s){return e.rexUI.add.customShapes({create:{lines:1},update:function(){const e=20,i=this.width,a=this.height,r=a-15;this.getShapes()[0].lineStyle(2,s,1).fillStyle(t,1).startAt(20,0).lineTo(i-e,0).arc(i-e,20,e,270,360).lineTo(i,r-e).arc(i-e,r-e,e,0,90).lineTo(60,r).lineTo(50,a).lineTo(40,r).lineTo(20,r).arc(20,r-e,e,90,180).lineTo(0,20).arc(20,20,e,180,270).close()}})}}class f extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"exit"),this.nextActivability=0,this.activabilityRate=500,e.add.existing(this),this.setInteractive(),this.setScrollFactor(0),this.setScale(.5),this.create()}create(){this.on("pointerdown",(()=>{this.activate()})),this.on("pointerover",(()=>{this.scene.sys.canvas.style.cursor="pointer"})),this.on("pointerout",(()=>{this.scene.sys.canvas.style.cursor="default"}))}activate(){this.scene.time.now>this.nextActivability&&(this.nextActivability=this.scene.time.now+this.activabilityRate,this.scene.events.emit("ExitButton::exit"),this.scene.store.get("fx")&&this.scene.sound.play("switcher"))}}class S extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){const i=e.store.get("fx");super(e,t,s,i?"audio_on":"audio_off"),this.nextActivability=0,this.activabilityRate=500,e.add.existing(this),this.setInteractive(),this.setScrollFactor(0),this.setScale(.5),this.create()}create(){this.on("pointerdown",(()=>{this.activate()})),this.on("pointerover",(()=>{this.scene.sys.canvas.style.cursor="pointer"})),this.on("pointerout",(()=>{this.scene.sys.canvas.style.cursor="default"}))}activate(){if(this.scene.time.now>this.nextActivability){this.nextActivability=this.scene.time.now+this.activabilityRate;const e=this.scene.store.get("fx");this.scene.store.set("fx",!e),e||this.setTexture("audio_on"),e&&this.setTexture("audio_off"),e&&this.scene.sound.play("switcher")}}}class b extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){const i=e.store.get("music");super(e,t,s,i?"music_on":"music_off"),this.nextActivability=0,this.activabilityRate=500,e.add.existing(this),this.setInteractive(),this.setScrollFactor(0),this.setScale(.5),this.create()}create(){this.on("pointerdown",(()=>{this.activate()})),this.on("pointerover",(()=>{this.scene.sys.canvas.style.cursor="pointer"})),this.on("pointerout",(()=>{this.scene.sys.canvas.style.cursor="default"}))}activate(){if(this.scene.time.now>this.nextActivability){this.nextActivability=this.scene.time.now+this.activabilityRate;const e=this.scene.store.get("music");this.scene.store.set("music",!e),e||this.setTexture("music_on"),e&&this.setTexture("music_off"),this.scene.store.get("fx")&&this.scene.sound.play("switcher")}}}class w extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"reset"),this.nextActivability=0,this.activabilityRate=500,e.add.existing(this),this.setInteractive(),this.setScrollFactor(0),this.setScale(.5),this.create()}create(){this.on("pointerdown",(()=>{this.activate()})),this.on("pointerover",(()=>{this.scene.sys.canvas.style.cursor="pointer"})),this.on("pointerout",(()=>{this.scene.sys.canvas.style.cursor="default"}))}activate(){this.scene.time.now>this.nextActivability&&(this.nextActivability=this.scene.time.now+this.activabilityRate,this.scene.events.emit("ResetButton::reset"),this.scene.store.get("fx")&&this.scene.sound.play("switcher"))}}class _{constructor(e,t,s){this.scene=e,this.x=t,this.y=s;const i=e.store.get("score");this.score=null!=i?i:0,this.create()}create(){this.updatetext(),this.scene.events.on("Player::tps",(()=>{this.score++,this.scene.store.set("score",this.score),this.updatetext()}))}updatetext(){this.text&&this.text.destroy(),this.text=this.scene.add.text(Math.round(this.x),Math.round(this.y-30),"SCORE:"+this.score,{fontFamily:"Pixels",align:"left"}).setScale(1).setFontSize(30).setResolution(10).setOrigin(.5,.5).setColor("white").setScrollFactor(0)}}class P{constructor(e){new f(e,30,60),new w(e,80,60),new b(e,130,60),new S(e,180,60),new _(e,280,94)}}class L extends Phaser.Scene{constructor(e,t,s){super({key:e}),this.nextScene=t,this.tilesetKey=s,this.dialogs=new Map,this.isDialogLaunched=!1,this.nextActivability=0,this.activabilityRate=500,this.key=e}create(){var e,t,s;this.removeEvents(),this.hasFx=null===(e=this.store.get("fx"))||void 0===e||e,this.hasMusic=null===(t=this.store.get("music"))||void 0===t||t,this.currentScore=null!==(s=this.store.get("score"))&&void 0!==s?s:0,this.musicHasBeenPlayed=!1,this.ballGroup=this.add.group(),this.spatialTeleportersGroup=this.add.group(),this.simpleTimeTeleporterGroup=this.add.group(),this.simpleSwitcherGroup=this.add.group(),this.doubleTimeTeleportersGroup=this.add.group(),this.doubleSwitchersGroup=this.add.group(),this.multiTimeTeleportersGroup=this.add.group(),this.multiSwitchersGroup=this.add.group(),this.initMap(),this.initDoors(),this.initPastPlayers(),this.initTopBarUI(),this.listenToPlayerEvents(),this.listenToPastPlayersEvents(),this.listenToMyTextBoxEvents(),this.listenToMultiTimeTeleportersEvents(),this.launchMusic(),this.initAllowsTutorialsOption(),this.listenToTutorialsSwitcherEvents(),this.listenToResetButtonEvents(),this.listenToExitButtonEvents(),this.listenToFxButtonEvents(),this.listenToMusicButtonEvents()}update(e,t){this.player.update(),this.pastPlayersGroup.preUpdate(e,t),this.checkForTutorials(),this.checkForLevelEnd()}initTopBarUI(){new P(this)}removeEvents(){this.events.off("DoubleSwitcher::activate"),this.events.off("DoubleTimeTeleporter::activate"),this.events.off("StartScreen::switchFr"),this.events.off("StartScreen::switchEn"),this.events.off("SpatialTeleporter::teleport"),this.events.off("SpatialTeleporter::activate"),this.events.off("MultiSwitcher::activate"),this.events.off("MultiTimeTeleporter::setToOpen"),this.events.off("TutorialsGame::go"),this.events.off("StartNewGame::go"),this.events.off("ContinueGame::go"),this.events.off("PastPlayer::init"),this.events.off("PastPlayer::isDead"),this.events.off("Player::isDead"),this.events.off("Player::canDetect"),this.events.off("Player::shotBullet"),this.events.off("PastPlayer::shotBullet"),this.events.off("RedSpatialTeleporter::activate"),this.events.off("SimpleSwitcher::activate"),this.events.off("SimpleTimeTeleporter::activate"),this.events.off("SoundSwitcher::fx"),this.events.off("TutorialsSwitcher::tutorials"),this.events.off("Store::lang"),this.events.off("Store::music"),this.events.off("Store::tutorials"),this.events.off("Store::fx"),this.events.off("ExitButton::exit"),this.events.off("MyTextBox::complete"),this.events.off("ResetButton::reset"),this.events.off("DoubleSwitcher::activate"),this.events.off("StartScreen::switchMusic"),this.events.off("StartScreen::switchFx"),this.events.off("StartScreen::switchTutorials")}listenToMusicButtonEvents(){this.events.on("Store::music",(e=>{this.hasMusic=e,e||this.music.pause(),e&&(this.musicHasBeenPlayed&&this.music.resume(),this.musicHasBeenPlayed||this.launchMusic())}))}listenToFxButtonEvents(){this.events.on("Store::fx",(e=>{this.hasFx=e}))}listenToResetButtonEvents(){this.events.on("ResetButton::reset",(()=>{this.store.set("score",this.currentScore),this.music.stop(),this.scene.start(this.key)}))}listenToExitButtonEvents(){this.events.on("ExitButton::exit",(()=>{this.music.stop(),this.scene.start(i.StartScreen)}))}initPlayer(){var e,t;const s=this.tilemap.filterObjects(r.STAIRS_DETECTION,(e=>e.name===a.STAIRS_LINE));this.start=this.tilemap.findObject(r.PLAYER,(e=>e.name===a.START)),this.end=this.tilemap.findObject(r.PLAYER,(e=>e.name===a.END)),this.player=new v(this,(null===(e=this.start)||void 0===e?void 0:e.x)||0,(null===(t=this.start)||void 0===t?void 0:t.y)||0,s),this.player.create(),this.cameras.main.startFollow(this.player),this.cameras.main.setLerp(.1,.1),this.physics.add.collider(this.player,[this.groundLayer,this.platformsLayer]),this.stairsLayer&&this.physics.add.collider(this.player,this.stairsLayer)}createSimpleTimeTeleporter(){const e=this.utils.findObjectByLayerAndProperties(r.TELEPORTERS_SIMPLE,{num:0});if(e){const t=new T(this,(null==e?void 0:e.x)||0,(null==e?void 0:e.y)||0);t.setData("num",0),this.simpleTimeTeleporterGroup.add(t)}}createSimpleSwitcher(){const e=this.utils.findObjectByLayerAndProperties(r.SWITCHERS_SIMPLE,{num:0});if(e){const t=new g(this,(null==e?void 0:e.x)||0,(null==e?void 0:e.y)||0);t.setData("num",0),this.simpleSwitcherGroup.add(t)}}createDoubleTimeTeleporters(){const e=this.utils.findObjectByLayerAndProperties(r.TELEPORTERS_DOUBLE,{num:0}),t=this.utils.findObjectByLayerAndProperties(r.TELEPORTERS_DOUBLE,{num:1});if(e&&t){const s=new d(this,(null==e?void 0:e.x)||0,(null==e?void 0:e.y)||0),i=new d(this,(null==t?void 0:t.x)||0,(null==t?void 0:t.y)||0);s.addOpposite(i),i.addOpposite(s),this.doubleTimeTeleportersGroup.add(s),this.doubleTimeTeleportersGroup.add(i)}}createDoubleSwitcher(){const e=this.utils.findObjectByLayerAndProperties(r.SWITCHERS_DOUBLE,{num:0});if(e){const t=new c(this,(null==e?void 0:e.x)||0,(null==e?void 0:e.y)||0);this.doubleSwitchersGroup.add(t)}}createMultiTimeTeleporterByNum(e){const t=this.utils.findObjectByLayerAndProperties(r.TELEPORTERS_MULTI,{num:e});if(t){const s=this.utils.getPropertiesAsObject(t),i=new u(this,(null==t?void 0:t.x)||0,(null==t?void 0:t.y)||0,e);i.setData("num",e),i.setData("close",s.close),this.multiTimeTeleportersGroup.add(i)}}createMultiSwitcherByNum(e){const t=this.utils.findObjectByLayerAndProperties(r.SWITCHERS_MULTI,{num:e});if(t){const s=new p(this,(null==t?void 0:t.x)||0,(null==t?void 0:t.y)||0,e);this.multiSwitchersGroup.add(s)}}createSpatialTeleporters(){const e=this.utils.filterObjectsByLayerAndName(r.TELEPORTERS_SPATIAL,"spatial_door");for(const t of e){const{num:e,group:s,sprite:i}=this.utils.getPropertiesAsObject(t),a=new m(this,(null==t?void 0:t.x)||0,(null==t?void 0:t.y)||0,i,s,e);this.spatialTeleportersGroup.add(a)}}initSimpleTimeTeleporterWorldColliders(){this.physics.add.collider(this.simpleTimeTeleporterGroup,[this.groundLayer,this.platformsLayer])}initDoubleTimeTeleportersWorldColliders(){this.physics.add.collider(this.doubleTimeTeleportersGroup,[this.groundLayer,this.platformsLayer])}initMultiTimeTeleportersWorldColliders(){this.physics.add.collider(this.multiTimeTeleportersGroup,[this.groundLayer,this.platformsLayer])}closeMultiTimeTeleporters(){this.utils.iterateOnGroup(this.multiTimeTeleportersGroup,(e=>{e.getData("close")&&e.setToClose()}))}initSimpleTimeTeleporterObjectsColliders(){const e=this.utils.findObjectOnGroupByData(this.simpleTimeTeleporterGroup,{num:0});if(e){const t=this.physics.add.collider(this.player,this.simpleTimeTeleporterGroup,((e,t)=>{this.utils.shakeOnTpCollision();const s=t;s.activate(),this.events.emit("BaseLevel::firstTp");const i="left"===this.player.direction?-20:20,a=new y(this,s.x-i,s.y,this.player);this.pastPlayersGroup.add(a)})),s=this.physics.add.collider(this.simpleTimeTeleporterGroup,this.ballGroup,((e,t)=>{t.destroy()}));this.physics.add.collider(this.simpleTimeTeleporterGroup,this.pastPlayersGroup,((e,t)=>{const s=t.body.gameObject.x,i=e.body.gameObject.x;i>s&&t.body.gameObject.setX(s-20),i<s&&t.body.gameObject.setX(s+20)})),e.addColliders(t,s)}}initMultiTimeTeleportersObjectsCollidersByNum(e){const t=this.utils.findObjectOnGroupByData(this.multiTimeTeleportersGroup,{num:e});if(t){const e=this.physics.add.collider(this.player,t,((e,t)=>{this.utils.shakeOnTpCollision(),t.activate();const s="left"===e.direction?-20:20,i=new y(this,t.x-s,t.y,this.player);this.pastPlayersGroup.add(i)})),s=this.physics.add.collider(t,this.ballGroup,((e,t)=>{t.destroy()}));this.physics.add.collider(t,this.pastPlayersGroup,((e,t)=>{const s=t.body.gameObject.x,i="left"===this.player.direction?-20:20;t.body.gameObject.setX(s-i)})),t.addColliders(s,e)}}initMultiTimeTeleportersOpposites(){const e=this.multiTimeTeleportersGroup.getLength(),t=Array.from(Array(e).keys());this.utils.iterateOnGroup(this.multiTimeTeleportersGroup,(e=>{t.forEach((t=>{if(t!==e.num){const s=this.utils.findObjectOnGroupByData(this.multiTimeTeleportersGroup,{num:t});if(!s)throw new Error(`Unfound MultiTimeTeleporterwith num: ${t}`);e.addOpposites(s)}}))}))}initDoubleTimeTeleportersObjectsColliders(){this.utils.iterateOnGroup(this.doubleTimeTeleportersGroup,(e=>{const t=this.physics.add.collider(this.player,e,(()=>{this.utils.shakeOnTpCollision(),e.activate();const t="left"===this.player.direction?-20:20,s=new y(this,e.x-t,e.y,this.player);this.pastPlayersGroup.add(s)})),s=this.physics.add.collider(e,this.ballGroup,((e,t)=>{t.destroy()}));this.physics.add.collider(e,this.pastPlayersGroup,((e,t)=>{const s=t.body.gameObject.x,i="left"===this.player.direction?-20:20;t.body.gameObject.setX(s-i)})),e.addColliders(s,t)}))}checkForSpatialTeleportersActivation(){this.utils.iterateOnGroup(this.spatialTeleportersGroup,(e=>{this.utils.intersectObjects(this.player,e)&&this.player.enterActivate&&e.activate()}))}checkForSimpleSwitcherActivation(){this.utils.iterateOnGroup(this.simpleSwitcherGroup,(e=>{this.utils.intersectObjects(this.player,e)&&this.player.enterActivate&&e.activate()}))}checkForDoubleSwitcherActivation(){this.utils.iterateOnGroup(this.doubleSwitchersGroup,(e=>{this.utils.intersectObjects(this.player,e)&&this.player.enterActivate&&e.activate()}))}checkForMultiSwitchersActivation(){this.utils.iterateOnGroup(this.multiSwitchersGroup,(e=>{this.utils.intersectObjects(this.player,e)&&this.player.enterActivate&&e.activate()}))}listenToMultiTimeTeleportersEvents(){this.events.on("MultiTimeTeleporter::setToOpen",(e=>{this.initMultiTimeTeleportersObjectsCollidersByNum(e)}))}addDialog(e,t){const{x:s,y:i}=this.tilemap.findObject("dialogs",(t=>t.properties[0].value===e));this.dialogs.set(JSON.stringify({x:s,y:i}),t)}startDialog(e){if(!this.isDialogLaunched&&this.allowsTutorials){const t=this.cameras.main.worldView.x+25,s=this.cameras.main.worldView.y+this.cameras.main.height/2;this.textBox=new x(this,t,s),this.textBox.start(e),this.player.pause(),this.isDialogLaunched=!0}}checkForLevelEnd(){var e,t,s,i,a;if(this.player.x>((null===(e=this.end)||void 0===e?void 0:e.x)||0)-10&&this.player.x<((null===(t=this.end)||void 0===t?void 0:t.x)||0)+10&&this.player.y>((null===(s=this.end)||void 0===s?void 0:s.y)||0)-10&&this.player.y<((null===(i=this.end)||void 0===i?void 0:i.y)||0)+10&&this.player.enterActivate){const e=this.utils.findObjectOnGroup(this.pastPlayersGroup,(e=>!e.isDead));(null===(a=this.pastPlayersGroup)||void 0===a?void 0:a.getLength())>0&&e?this.time.now>this.nextActivability&&(this.nextActivability=this.time.now+this.activabilityRate,this.hasFx&&this.sound.play("door_close")):(this.hasFx&&this.sound.play("end_level"),this.music.stop(),this.scene.start(this.nextScene))}}listenToPastPlayersEvents(){this.events.on("PastPlayer::init",(()=>{this.time.delayedCall(200,(()=>{this.doorExit.close()}))}),this),this.events.on("PastPlayer::shotBullet",(e=>{this.ballGroup.add(e),this.physics.add.collider([this.groundLayer],e,(()=>{e.destroy()}))}),this),this.events.on("PastPlayer::isDead",(()=>{this.utils.findObjectOnGroup(this.pastPlayersGroup,(e=>!e.isDead))||this.time.delayedCall(200,(()=>{this.doorExit.open()}))}),this)}listenToPlayerEvents(){this.events.on("Player::shotBullet",(e=>{this.events.emit("BaseLevel::firstShotGun"),this.ballGroup.add(e),this.physics.add.collider([this.groundLayer],e,(()=>{e.destroy()}))}),this),this.events.on("Player::isDead",(()=>{this.store.set("score",0),alert(this.translate.get(i.BaseLevel,0)),location.reload()}))}listenToMyTextBoxEvents(){this.events.on("MyTextBox::complete",(()=>{this.isDialogLaunched=!1,this.time.delayedCall(500,(()=>{this.player.resume()}))}),this)}initDoors(){if(this.tilemap.findObject(r.DOORS,(e=>e.name===a.DOOR_START))){const{x:e,y:t}=this.tilemap.findObject(r.DOORS,(e=>e.name===a.DOOR_START));this.doorEntrance=new n(this,e||0,t||0)}if(this.tilemap.findObject(r.DOORS,(e=>e.name===a.DOOR_END))){const{x:e,y:t}=this.tilemap.findObject(r.DOORS,(e=>e.name===a.DOOR_END));this.doorExit=new h(this,e||0,t||0)}this.doorEntrance&&this.doorExit&&this.physics.add.collider([this.doorEntrance,this.doorExit],[this.groundLayer,this.platformsLayer])}initPastPlayers(){this.pastPlayersGroup=this.add.group(),this.pastPlayersGroup.runChildUpdate=!0,this.physics.add.collider(this.pastPlayersGroup,[this.groundLayer,this.platformsLayer])}initMap(){this.tilemap=this.add.tilemap(this.tilesetKey),this.tileset=this.tilemap.addTilesetImage("tileset","tileset"),this.bckgLayer=this.tilemap.createLayer(r.BACKGROUND,this.tileset,0,0),this.groundLayer=this.tilemap.createLayer(r.GROUND,this.tileset,0,0),this.wallLayer=this.tilemap.createLayer(r.WALL,this.tileset,0,0),this.wall2Layer=this.tilemap.createLayer(r.WALL2,this.tileset,0,0),this.desksLayer=this.tilemap.createLayer(r.DESKS,this.tileset,0,0),this.platformsLayer=this.tilemap.createLayer(r.PLATFORMS,this.tileset,0,0),this.ceilingLayer=this.tilemap.createLayer(r.CEILING,this.tileset,0,0),this.lightsLayer=this.tilemap.createLayer(r.LIGHTS,this.tileset,0,0),this.stairsLayer=this.tilemap.createLayer(r.STAIRS,this.tileset,0,0),this.stairsLayer&&this.stairsLayer.setCollisionByProperty({collides:!0}),this.groundLayer.setCollisionByProperty({collides:!0}),this.platformsLayer.setCollisionByProperty({collides:!0}),this.cameras.main.setBounds(0,0,this.tilemap.widthInPixels,this.tilemap.heightInPixels),this.physics.world.setBounds(0,0,this.tilemap.widthInPixels,this.tilemap.heightInPixels),this.utils.init(this.tilemap)}checkForTutorials(){this.allowsTutorials&&this.dialogs.forEach(((e,t)=>{const{x:s,y:i}=JSON.parse(t);this.isDialogLaunched||this.player.x>(s||0)-10&&this.player.x<(s||0)+10&&this.player.y>(i||0)-10&&this.player.y<(i||0)+10&&(this.startDialog(e),this.dialogs.delete(t))}))}launchMusic(){this.music=this.sound.add("levels"),this.hasMusic&&!this.music.isPlaying&&(this.musicHasBeenPlayed=!0,this.music.play({loop:!0,volume:.1}))}initAllowsTutorialsOption(){const e=this.store.get("tutorials");null!==e&&(this.allowsTutorials=e),null===e&&(this.allowsTutorials=!0)}listenToTutorialsSwitcherEvents(){this.events.on("TutorialsSwitcher::tutorials",(e=>{this.allowsTutorials=e}))}}class O extends Phaser.Scene{constructor(){super({key:i.PreloadStartScreen})}preload(){const e=this.add.graphics(),t=this.add.graphics();t.fillStyle(2236962,.8),t.fillRect(140,240,320,50);const s=this.cameras.main.width,i=this.cameras.main.height,a=this.make.text({x:s/2,y:i/2-50,text:"Loading...",style:{font:"20px Pixels",color:"#ffffff"}});a.setOrigin(.5,.5);const r=this.make.text({x:s/2,y:i/2-30,text:"0%",style:{font:"18px Pixels",color:"#ffffff"}});r.setOrigin(.5,.5);const o=this.make.text({x:s/2,y:i/2+70,text:"",style:{font:"18px Pixels",color:"#ffffff"}});o.setOrigin(.5,.5),this.load.on("progress",(t=>{e.clear(),e.fillStyle(16777215,1),e.fillRect(140,240,300*t,30),r.setText(parseInt((100*t).toString())+"%")})),this.load.on("fileprogress",(e=>{const t=e.src.split("/"),s=t[t.length-1];o.setText("Loading asset: "+s)})),this.load.on("complete",(()=>{o.destroy(),r.destroy(),a.destroy(),e.destroy(),t.destroy(),this.load.off("progress"),this.load.off("fileprogress"),this.load.off("complete")})),this.load.json("translations","assets/json/options/translations.json"),this.load.scenePlugin({key:"rexUI",sceneKey:"rexUI"}),this.load.image("nextPage","assets/img/ui/arrow-down-left.png"),this.load.image("dialogEnd","assets/img/ui/cancel.png"),this.load.audio("death","assets/sounds/death.wav"),this.load.audio("door_tp","assets/sounds/door_tp.wav"),this.load.audio("simple_gun_shot","assets/sounds/simple_gun_shot.wav"),this.load.audio("levels","assets/sounds/levels.wav"),this.load.audio("tp","assets/sounds/tp.wav"),this.load.audio("walk","assets/sounds/walk.wav"),this.load.audio("switcher","assets/sounds/switcher.wav"),this.load.audio("door_open","assets/sounds/door_open.wav"),this.load.audio("door_close","assets/sounds/door_close.wav"),this.load.audio("end_level","assets/sounds/end_level.wav"),this.load.bitmapFont("pixels","assets/fonts/pixels.png","assets/fonts/pixels.xml.fnt"),this.load.image("tileset","assets/img/tileset.png"),this.load.image("title","assets/img/logo.png"),this.load.image("door_start","assets/img/objects/door_start.png"),this.load.image("door_end_open","assets/img/objects/door_end_open.png"),this.load.image("door_end_close","assets/img/objects/door_end_close.png"),this.load.image("door_tp_red","assets/img/objects/door_tp_red.png"),this.load.image("door_tp_green","assets/img/objects/door_tp_green.png"),this.load.image("door_tp_full_red","assets/img/objects/door_tp_full_red.png"),this.load.image("door_tp_full_green","assets/img/objects/door_tp_full_green.png"),this.load.image("tp_red","assets/img/objects/tp_red.png"),this.load.image("tp_red_close","assets/img/objects/tp_red_close.png"),this.load.image("tp_orange","assets/img/objects/tp_orange.png"),this.load.image("tp_orange_close","assets/img/objects/tp_orange_close.png"),this.load.image("tp_green","assets/img/objects/tp_green.png"),this.load.image("tp_green_close","assets/img/objects/tp_green_close.png"),this.load.image("switcher_red","assets/img/objects/switcher_red.png"),this.load.image("switcher_green","assets/img/objects/switcher_green.png"),this.load.image("switcher_orange","assets/img/objects/switcher_orange.png"),this.load.image("bool_white_on","assets/img/objects/bool_white_on.png"),this.load.image("bool_white_off","assets/img/objects/bool_white_off.png"),this.load.tilemapTiledJSON("tileset","assets/json/levels/game-screen.json"),this.load.atlas("player","assets/img/chars/player_atlas.png","assets/json/chars/player_atlas.json"),this.load.atlas("simple_bullet","assets/img/objects/simple_bullet_atlas.png","assets/json/objects/simple_bullet_atlas.json"),this.load.atlas("simple_gun_shot","assets/img/particles/simple_gun_shot.png","assets/json/particles/simple_gun_shot.json")}create(){this.scene.start(i.StartScreen)}}class E extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,a){super(e,t,s,i?"bool_white_on":"bool_white_off"),this.textContent=a,this.nextActivability=0,this.activabilityRate=500,this.isOn=i,this.setInteractive(),e.add.existing(this)}create(){this.on("pointerdown",(()=>{this.scene.time.now>this.nextActivability&&(this.nextActivability=this.scene.time.now+this.activabilityRate,this.activate())})),this.on("pointerover",(()=>{this.scene.sys.canvas.style.cursor="pointer"})),this.on("pointerout",(()=>{this.scene.sys.canvas.style.cursor="default"})),this.resolveState()}switch(){this.isOn=!this.isOn,this.resolveState(),this.scene.store.get("fx")&&this.scene.sound.play("switcher")}resolveState(){this.text&&this.text.destroy(),this.text=this.scene.add.text(Math.round(this.x),Math.round(this.y-30),this.textContent,{fontFamily:"Pixels",align:"left"}).setScale(1).setFontSize(15).setResolution(10).setOrigin(.5,.5),this.isOn&&(this.text.setColor("blue").setAlpha(1),this.setTexture("bool_white_on")),this.isOn||(this.text.setColor("red").setAlpha(.2),this.setTexture("bool_white_off"))}}class D extends E{constructor(e,t,s){const i=e.store.get("lang");super(e,t,s,null!==i&&"en"===i,"EN"),this.create()}create(){super.create(),this.scene.events.on("StartScreen::switchEn",(()=>{this.scene.time.now>this.nextActivability&&(this.nextActivability=this.scene.time.now+this.activabilityRate,this.activate())}),this)}activate(){this.switch(),this.scene.events.emit("StartScreen::switchFr"),this.isOn&&this.scene.store.set("lang","en")}}class A extends E{constructor(e,t,s){const i=e.store.get("lang");super(e,t,s,null===i||"fr"===i,"FR"),this.create()}create(){super.create(),this.scene.events.on("StartScreen::switchFr",(()=>{this.scene.time.now>this.nextActivability&&(this.nextActivability=this.scene.time.now+this.activabilityRate,this.activate())}),this)}activate(){this.switch(),this.scene.events.emit("StartScreen::switchEn"),this.isOn&&this.scene.store.set("lang","fr")}}class C extends E{constructor(e,t,s){const i=e.store.get("music");super(e,t,s,null==i||i,"MUSIC"),this.create()}create(){super.create(),this.scene.events.on("StartScreen::switchMusic",(()=>{this.scene.time.now>this.nextActivability&&(this.nextActivability=this.scene.time.now+this.activabilityRate,this.activate())}),this)}activate(){this.switch(),this.scene.store.set("music",this.isOn)}}class B extends E{constructor(e,t,s){const i=e.store.get("fx");super(e,t,s,null==i||i,"FX"),this.create()}create(){super.create(),this.scene.events.on("StartScreen::switchFx",(()=>{this.scene.time.now>this.nextActivability&&(this.nextActivability=this.scene.time.now+this.activabilityRate,this.activate())}),this)}activate(){this.switch(),this.scene.store.set("fx",this.isOn),this.scene.events.emit("SoundSwitcher::fx",this.isOn)}}class R extends E{constructor(e,t,s){const i=e.store.get("tutorials");super(e,t,s,null==i||i,"TUTORIALS"),this.create()}create(){super.create(),this.scene.events.on("StartScreen::switchTutorials",(()=>{this.scene.time.now>this.nextActivability&&(this.nextActivability=this.scene.time.now+this.activabilityRate,this.activate())}),this)}activate(){this.switch(),this.scene.store.set("tutorials",this.isOn),this.scene.events.emit("TutorialsSwitcher::tutorials",this.isOn)}}class j extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"door_start"),this.setInteractive(),e.add.existing(this),this.create()}create(){this.scene.add.text(Math.round(this.x),Math.round(this.y-30),"NEW GAME",{fontFamily:"Pixels",align:"left"}).setScale(1).setFontSize(15).setResolution(10).setOrigin(.5,.5).setColor("blue"),this.on("pointerdown",(()=>{this.scene.events.emit("StartNewGame::go")})),this.on("pointerover",(()=>{this.scene.sys.canvas.style.cursor="pointer"})),this.on("pointerout",(()=>{this.scene.sys.canvas.style.cursor="default"}))}}class G extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){var i;const a=e.store.get("level");super(e,t,s,a?"door_start":"door_end_close"),this.setInteractive(),e.add.existing(this),this._isOpen=null!==a,this.hasFx=null===(i=this.scene.store.get("fx"))||void 0===i||i,this.create()}get isOpen(){return this._isOpen}create(){this.scene.events.on("Store::fx",(e=>{this.hasFx=e})),this.scene.add.text(Math.round(this.x),Math.round(this.y-30),"CONTINUE",{fontFamily:"Pixels",align:"left"}).setScale(1).setFontSize(15).setResolution(10).setOrigin(.5,.5).setColor("blue"),this.on("pointerdown",(()=>{this._isOpen||!this.hasFx?this.scene.events.emit("ContinueGame::go"):this.scene.sound.play("door_close")})),this.on("pointerover",(()=>{this.scene.sys.canvas.style.cursor="pointer"})),this.on("pointerout",(()=>{this.scene.sys.canvas.style.cursor="default"}))}}class M extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"door_start"),this.setInteractive(),e.add.existing(this),this.create()}create(){this.scene.add.text(Math.round(this.x),Math.round(this.y-30),"TUTORIALS",{fontFamily:"Pixels",align:"left"}).setScale(1).setFontSize(15).setResolution(10).setOrigin(.5,.5).setColor("blue"),this.on("pointerdown",(()=>{this.scene.events.emit("TutorialsGame::go")})),this.on("pointerover",(()=>{this.scene.sys.canvas.style.cursor="pointer"})),this.on("pointerout",(()=>{this.scene.sys.canvas.style.cursor="default"}))}}class k extends Phaser.Scene{constructor(){super({key:i.StartScreen}),this.dialogs=new Map,this.isDialogLaunched=!1,this.nextActivability=0,this.activabilityRate=500,this.nextScene=i.PreloadLevel1,this.tilesetKey="tileset"}create(){var e,t;this.removeEvents(),this.hasFx=null===(e=this.store.get("fx"))||void 0===e||e,this.hasMusic=null===(t=this.store.get("music"))||void 0===t||t,this.musicHasBeenPlayed=!1,this.ballGroup=this.add.group(),this.initMap(),this.buildWhiteSwitchers(),this.initTutorialsGame(),this.initStartNewGame(),this.initContinueGame(),this.listenToPlayerEvents(),this.listenToMyTextBoxEvents(),this.initPlayer(),this.launchMusic(),this.addDialog(0,this.translate.get(i.StartScreen,0)),this.listenToTutorialsGameEvents(),this.listenToStartNewGameEvents(),this.listenToContinueGameEvents(),this.initAllowsTutorialsOption(),this.listenToMusicSwitcherEvents(),this.listenToTutorialsSwitcherEvents(),this.listenToFxButtonEvents()}update(){this.player.update(),this.checkForTutorials(),this.checkForOptions(),this.checkTutorialsGame(),this.checkStartNewGame(),this.checkContinueGame()}listenToFxButtonEvents(){this.events.on("Store::fx",(e=>{this.hasFx=e}))}listenToStartNewGameEvents(){this.events.on("StartNewGame::go",(()=>{this.goLevel1()}))}listenToTutorialsGameEvents(){this.events.on("TutorialsGame::go",(()=>{this.goTutorials()}))}listenToContinueGameEvents(){this.events.on("ContinueGame::go",(()=>{this.goContinue()}))}removeEvents(){this.events.off("DoubleSwitcher::activate"),this.events.off("DoubleTimeTeleporter::activate"),this.events.off("StartScreen::switchFr"),this.events.off("StartScreen::switchEn"),this.events.off("SpatialTeleporter::teleport"),this.events.off("SpatialTeleporter::activate"),this.events.off("MultiSwitcher::activate"),this.events.off("MultiTimeTeleporter::setToOpen"),this.events.off("TutorialsGame::go"),this.events.off("StartNewGame::go"),this.events.off("ContinueGame::go"),this.events.off("PastPlayer::init"),this.events.off("PastPlayer::isDead"),this.events.off("Player::isDead"),this.events.off("Player::shotBullet"),this.events.off("PastPlayer::shotBullet"),this.events.off("Player::canDetect"),this.events.off("RedSpatialTeleporter::activate"),this.events.off("SimpleSwitcher::activate"),this.events.off("SimpleTimeTeleporter::activate"),this.events.off("SoundSwitcher::fx"),this.events.off("TutorialsSwitcher::tutorials"),this.events.off("Store::lang"),this.events.off("Store::music"),this.events.off("Store::tutorials"),this.events.off("Store::fx"),this.events.off("ExitButton::exit"),this.events.off("MyTextBox::complete"),this.events.off("ResetButton::reset"),this.events.off("DoubleSwitcher::activate"),this.events.off("StartScreen::switchMusic"),this.events.off("StartScreen::switchFx"),this.events.off("StartScreen::switchTutorials")}initContinueGame(){const e=this.utils.findObjectByLayerAndName(r.OPTIONS,"continue");e&&(this.continueGameCoordinates={x:e.x,y:e.y},this.continueGameDoor=new G(this,this.continueGameCoordinates.x,this.continueGameCoordinates.y))}initTutorialsGame(){const e=this.utils.findObjectByLayerAndName(r.OPTIONS,"tutorials");e&&(this.tutorialsCoordinates={x:e.x,y:e.y},new M(this,this.tutorialsCoordinates.x,this.tutorialsCoordinates.y))}initStartNewGame(){const e=this.utils.findObjectByLayerAndName(r.OPTIONS,"start");e&&(this.startNewGameCoordinates={x:e.x,y:e.y},new j(this,this.startNewGameCoordinates.x,this.startNewGameCoordinates.y))}buildWhiteSwitchers(){var e,t;const s=this.utils.filterObjectsByLayerAndName(r.OPTIONS,"bool-white");if(s.length>0)for(const i of s)switch(this.utils.getPropertiesAsObject(i).name){case"music":this.musicSwitcherCoordinates={x:i.x,y:i.y},new C(this,(null==i?void 0:i.x)||0,(null==i?void 0:i.y)||0);break;case"sound":this.soundSwitcherCoordinates={x:i.x,y:i.y},new B(this,(null==i?void 0:i.x)||0,(null==i?void 0:i.y)||0);break;case"fr":this.frSwitcherCoordinates={x:i.x,y:i.y},new A(this,(null==i?void 0:i.x)||0,(null==i?void 0:i.y)||0);break;case"en":this.enSwitcherCoordinates={x:i.x,y:i.y},new D(this,(null==i?void 0:i.x)||0,(null==i?void 0:i.y)||0);break;case"tutorials":this.tutorialsSwitcherCoordinates={x:null!==(e=i.x)&&void 0!==e?e:0,y:null!==(t=i.y)&&void 0!==t?t:0},new R(this,(null==i?void 0:i.x)||0,(null==i?void 0:i.y)||0)}}checkStartNewGame(){this.utils.coordinatesAreNear(this.startNewGameCoordinates,this.player)&&this.player.enterActivate&&this.goLevel1()}checkTutorialsGame(){this.utils.coordinatesAreNear(this.tutorialsCoordinates,this.player)&&this.player.enterActivate&&this.goTutorials()}checkContinueGame(){this.utils.coordinatesAreNear(this.continueGameCoordinates,this.player)&&this.player.enterActivate&&this.time.now>this.nextActivability&&(this.nextActivability=this.time.now+this.activabilityRate,this.continueGameDoor.isOpen||this.hasFx&&this.sound.play("door_close"),this.goContinue())}goLevel1(){this.hasFx&&this.sound.play("door_tp"),this.music.stop(),this.store.set("score",0),this.scene.start(i.PreloadLevel1)}goContinue(){const e=this.store.get("level");e&&(this.hasFx&&this.sound.play("door_tp"),this.music.stop(),this.scene.start(e))}goTutorials(){this.hasFx&&this.sound.play("door_tp"),this.music.stop(),this.scene.start(i.PreloadTutorials)}checkForOptions(){this.utils.coordinatesAreNear(this.musicSwitcherCoordinates,this.player)&&this.player.enterActivate&&this.events.emit("StartScreen::switchMusic"),this.utils.coordinatesAreNear(this.soundSwitcherCoordinates,this.player)&&this.player.enterActivate&&this.events.emit("StartScreen::switchFx"),this.utils.coordinatesAreNear(this.frSwitcherCoordinates,this.player)&&this.player.enterActivate&&this.events.emit("StartScreen::switchFr"),this.utils.coordinatesAreNear(this.enSwitcherCoordinates,this.player)&&this.player.enterActivate&&this.events.emit("StartScreen::switchEn"),this.utils.coordinatesAreNear(this.tutorialsSwitcherCoordinates,this.player)&&this.player.enterActivate&&this.events.emit("StartScreen::switchTutorials")}initPlayer(){var e,t;this.start=this.tilemap.findObject(r.PLAYER,(e=>e.name===a.START)),this.player=new v(this,(null===(e=this.start)||void 0===e?void 0:e.x)||0,(null===(t=this.start)||void 0===t?void 0:t.y)||0),this.player.create(),this.cameras.main.startFollow(this.player),this.cameras.main.setLerp(.1,.1),this.physics.add.collider(this.player,[this.groundLayer,this.platformsLayer])}addDialog(e,t){const{x:s,y:i}=this.tilemap.findObject("dialogs",(t=>t.properties[0].value===e));this.dialogs.set(JSON.stringify({x:s,y:i}),t)}startDialog(e){if(!this.isDialogLaunched){const t=this.cameras.main.worldView.x+25,s=this.cameras.main.worldView.y+this.cameras.main.height/2;this.textBox=new x(this,t,s),this.textBox.start(e),this.player.pause(),this.isDialogLaunched=!0}}listenToPlayerEvents(){this.events.on("Player::shotBullet",(e=>{this.events.emit("StartScreen::firstShotGun"),this.ballGroup.add(e),this.physics.add.collider([this.groundLayer],e,(()=>{e.destroy()}))}),this)}listenToMyTextBoxEvents(){this.events.on("MyTextBox::complete",(()=>{this.isDialogLaunched=!1,this.time.delayedCall(500,(()=>{this.player.resume()}))}),this)}initMap(){this.tilemap=this.add.tilemap(this.tilesetKey),this.tileset=this.tilemap.addTilesetImage("tileset","tileset");const e=this.tilemap.addTilesetImage("title","title");this.bckgLayer=this.tilemap.createLayer(r.BACKGROUND,this.tileset,0,0),this.groundLayer=this.tilemap.createLayer(r.GROUND,this.tileset,0,0),this.wallLayer=this.tilemap.createLayer(r.WALL,this.tileset,0,0),this.wall2Layer=this.tilemap.createLayer(r.WALL2,this.tileset,0,0),this.desksLayer=this.tilemap.createLayer(r.DESKS,this.tileset,0,0),this.platformsLayer=this.tilemap.createLayer(r.PLATFORMS,this.tileset,0,0),this.ceilingLayer=this.tilemap.createLayer(r.CEILING,this.tileset,0,0),this.lightsLayer=this.tilemap.createLayer(r.LIGHTS,this.tileset,0,0),this.tpLayer=this.tilemap.createLayer(r.TP,this.tileset,0,0),this.titleLayer=this.tilemap.createLayer(r.TITLE,e,0,0),this.groundLayer.setCollisionByProperty({collides:!0}),this.platformsLayer.setCollisionByProperty({collides:!0}),this.cameras.main.setBounds(0,0,this.tilemap.widthInPixels,this.tilemap.heightInPixels),this.physics.world.setBounds(0,0,this.tilemap.widthInPixels,this.tilemap.heightInPixels),this.utils.init(this.tilemap)}checkForTutorials(){this.allowsTutorials&&this.dialogs.forEach(((e,t)=>{const{x:s,y:i}=JSON.parse(t);this.isDialogLaunched||this.player.x>(s||0)-10&&this.player.x<(s||0)+10&&this.player.y>(i||0)-10&&this.player.y<(i||0)+10&&(this.startDialog(e),this.dialogs.delete(t))}))}launchMusic(){this.music=this.sound.add("levels"),this.hasMusic&&!this.music.isPlaying&&(this.musicHasBeenPlayed=!0,this.music.play({loop:!0,volume:.1}))}listenToMusicSwitcherEvents(){this.events.on("Store::music",(e=>{this.hasMusic=e,e||this.music.pause(),e&&(this.musicHasBeenPlayed&&this.music.resume(),this.musicHasBeenPlayed||this.launchMusic())}))}initAllowsTutorialsOption(){const e=this.store.get("tutorials");null!==e&&(this.allowsTutorials=e),null===e&&(this.allowsTutorials=!0)}listenToTutorialsSwitcherEvents(){this.events.on("TutorialsSwitcher::tutorials",(e=>{this.allowsTutorials=e}))}}class F extends Phaser.Plugins.ScenePlugin{constructor(e,t){super(e,t,"utils")}init(e){this.tilemap=e}filterObjectsByLayerAndProperties(e,t){const s=this.tilemap.filterObjects(e,(e=>{const s=this.getPropertiesAsObject(e);return!!s&&Object.keys(t).every((e=>s[e]===t[e]))}));if(!s)throw new Error(`Objects with properties ${JSON.stringify(t)} not found in layer ${e}`);return s}findObjectByLayerAndName(e,t){const s=this.tilemap.findObject(e,(e=>e.name===t));if(!s)throw new Error(`Object with name ${t} not found in layer ${e}`);return s}filterObjectsByLayerAndName(e,t){const s=this.tilemap.filterObjects(e,(e=>e.name===t));if(!s)throw new Error(`Objects with name ${t} not found in layer ${e}`);return s}getPropertiesAsObject(e){return e.properties?e.properties.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.name]:t.value})),{}):null}coordinatesAreNear(e,t,s=10){const i=e.x-t.x,a=e.y-t.y,r=Math.sqrt(i*i+a*a);return Math.abs(r)<s}findObjectOnGroupByData(e,t){if((null==e?void 0:e.getLength())>0)return e.children.getArray().find((e=>Object.keys(t).every((s=>e.getData(s)===t[s]))));throw new Error(`Object not found with data ${JSON.stringify(t)}`)}iterateOnGroup(e,t){(null==e?void 0:e.getLength())>0&&e.children.iterate(t)}findObjectOnGroup(e,t){return(null==e?void 0:e.getLength())>0&&e.children.getArray().find(t)}intersectObjects(e,t){return(0,Phaser.Geom.Intersects.RectangleToRectangle)(e.getBounds(),t.getBounds())}findObjectByLayerAndProperties(e,t){const s=this.tilemap.findObject(e,(e=>{const s=this.getPropertiesAsObject(e);return Object.keys(t).every((e=>s[e]===t[e]))}));if(!s)throw new Error(`Object with properties ${JSON.stringify(t)} not found in layer ${e}`);return s}getMiddleSceneCoordinates(){return{x:this.scene.cameras.main.worldView.x+this.scene.cameras.main.width/2,y:this.scene.cameras.main.worldView.y+this.scene.cameras.main.height/2}}shakeOnTpCollision(){this.scene.cameras.main.shake(50,.01)}}class I extends Phaser.Plugins.ScenePlugin{constructor(e,t){super(e,t,"store"),this.prefix="paradoxe-game."}set(e,t){localStorage.setItem(this.prefix+e,JSON.stringify(t)),this.scene.events.emit("Store::"+e,t)}get(e){const t=localStorage.getItem(this.prefix+e);return t?JSON.parse(t):null}remove(e){localStorage.removeItem(this.prefix+e)}}class N extends Phaser.Plugins.ScenePlugin{constructor(e,t){super(e,t,"translate")}get(e,t){var s,i,a;if(this.translations||(this.translations=this.scene.cache.json.get("translations")),this.lang=null!==(s=this.scene.store.get("lang"))&&void 0!==s?s:"fr",!(null===(a=null===(i=this.translations[e])||void 0===i?void 0:i[this.lang])||void 0===a?void 0:a[t]))throw new Error(`translation not found for key ${e} and index ${t}`);return this.translations[e][this.lang][t]}}const W={type:Phaser.AUTO,backgroundColor:"#000",antialias:!1,scale:{parent:"phaser-game",mode:Phaser.Scale.NONE,autoCenter:Phaser.Scale.CENTER_BOTH,width:700,height:480},scene:[O,class extends l{constructor(){super(i.PreloadTutorials,i.Tutorials,"tutorials")}preload(){super.preload()}create(){super.create()}},class extends l{constructor(){super(i.PreloadLevel0,i.Level0,"level0")}preload(){super.preload()}create(){super.create()}},class extends l{constructor(){super(i.PreloadLevel1,i.Level1,"level1")}preload(){super.preload()}create(){super.create()}},class extends l{constructor(){super(i.PreloadLevel2,i.Level2,"level2")}preload(){super.preload()}create(){super.create()}},class extends l{constructor(){super(i.PreloadLevel3,i.Level3,"level3")}preload(){super.preload()}create(){super.create()}},class extends l{constructor(){super(i.PreloadLevel4,i.Level4,"level4")}preload(){super.preload()}create(){super.create()}},class extends l{constructor(){super(i.PreloadLevel5,i.Level5,"level5")}preload(){super.preload()}create(){super.create()}},class extends l{constructor(){super(i.PreloadLevel6,i.Level6,"level6")}preload(){super.preload()}create(){super.create()}},class extends l{constructor(){super(i.PreloadLevel7,i.Level7,"level7")}preload(){super.preload()}create(){super.create()}},class extends l{constructor(){super(i.PreloadLevel8,i.Level8,"level8")}preload(){super.preload()}create(){super.create()}},k,class extends L{constructor(){super(i.Tutorials,i.StartScreen,"tutorials"),this.endTutorialsMessagePlayed=!1}create(){super.create(),this.createSpatialTeleporters(),this.createSimpleTimeTeleporter(),this.createSimpleSwitcher(),this.createDoubleTimeTeleporters(),this.createDoubleSwitcher(),this.createMultiTimeTeleporterByNum(0),this.createMultiTimeTeleporterByNum(1),this.createMultiTimeTeleporterByNum(2),this.createMultiSwitcherByNum(0),this.createMultiSwitcherByNum(1),this.createMultiSwitcherByNum(2),this.initPlayer(),this.initSimpleTimeTeleporterObjectsColliders(),this.initSimpleTimeTeleporterWorldColliders(),this.initDoubleTimeTeleportersObjectsColliders(),this.initDoubleTimeTeleportersWorldColliders(),this.initMultiTimeTeleportersObjectsCollidersByNum(0),this.initMultiTimeTeleportersObjectsCollidersByNum(1),this.initMultiTimeTeleportersObjectsCollidersByNum(2),this.initMultiTimeTeleportersWorldColliders(),this.closeMultiTimeTeleporters(),this.initMultiTimeTeleportersOpposites(),this.listenToMultiTimeTeleportersEvents(),this.addDialog(0,this.translate.get(i.Tutorials,0)),this.addDialog(1,this.translate.get(i.Tutorials,1)),this.addDialog(2,this.translate.get(i.Tutorials,2)),this.addDialog(3,this.translate.get(i.Tutorials,3)),this.addDialog(4,this.translate.get(i.Tutorials,4)),this.addDialog(5,this.translate.get(i.Tutorials,5)),this.addDialog(6,this.translate.get(i.Tutorials,6)),this.addDialog(7,this.translate.get(i.Tutorials,7))}update(e,t){super.update(e,t),this.checkForSpatialTeleportersActivation(),this.checkForSimpleSwitcherActivation(),this.checkForDoubleSwitcherActivation(),this.checkForMultiSwitchersActivation();const s=this.tilemap.findObject(r.EVENTS,(e=>"end_tutorials"===e.name));!this.endTutorialsMessagePlayed&&s&&this.utils.coordinatesAreNear(s,this.player)&&(this.endTutorialsMessagePlayed=!0,this.player.pause(),alert(this.translate.get(i.Tutorials,8)),this.time.delayedCall(500,(()=>{this.player.resume()})))}},class extends L{constructor(){super(i.Level0,i.PreloadLevel1,"level0"),this.endPlayed=!1}create(){super.create(),this.initPlayer()}update(e,t){super.update(e,t)}},class extends L{constructor(){super(i.Level1,i.PreloadLevel2,"level1")}create(){super.create(),this.addDialog(0,this.translate.get(i.Level1,0)),this.addDialog(1,this.translate.get(i.Level1,1)),this.initPlayer()}update(e,t){super.update(e,t)}},class extends L{constructor(){super(i.Level2,i.PreloadLevel3,"level2")}create(){super.create(),this.addDialog(0,this.translate.get(i.Level2,0)),this.addDialog(1,this.translate.get(i.Level2,1)),this.initPlayer()}update(e,t){super.update(e,t),this.checkForSpatialTeleportersActivation()}},class extends L{constructor(){super(i.Level3,i.PreloadLevel4,"level3"),this.firstTpTaken=!1,this.firstShotGun=!1}create(){super.create(),this.createSimpleTimeTeleporter(),this.createSimpleSwitcher(),this.initPlayer(),this.initSimpleTimeTeleporterObjectsColliders(),this.initSimpleTimeTeleporterWorldColliders(),this.events.on("BaseLevel::firstTp",(()=>{this.firstTpTaken||(this.firstTpTaken=!0,this.startDialog(this.translate.get(i.Level3,0)))})),this.events.on("BaseLevel::firstShotGun",(()=>{this.firstTpTaken&&!this.firstShotGun&&this.time.delayedCall(1e3,(()=>{this.firstShotGun=!0,this.startDialog(this.translate.get(i.Level3,1))}))})),this.addDialog(0,this.translate.get(i.Level3,2))}update(e,t){super.update(e,t),this.checkForSpatialTeleportersActivation(),this.checkForSimpleSwitcherActivation()}},class extends L{constructor(){super(i.Level4,i.PreloadLevel5,"level4")}create(){super.create(),this.createDoubleTimeTeleporters(),this.createDoubleSwitcher(),this.initPlayer(),this.initDoubleTimeTeleportersObjectsColliders(),this.initDoubleTimeTeleportersWorldColliders(),this.addDialog(0,this.translate.get(i.Level4,0))}update(e,t){super.update(e,t),this.checkForSpatialTeleportersActivation(),this.checkForDoubleSwitcherActivation()}},class extends L{constructor(){super(i.Level5,i.PreloadLevel6,"level5")}create(){super.create(),this.createDoubleTimeTeleporters(),this.createDoubleSwitcher(),this.createSimpleTimeTeleporter(),this.createSimpleSwitcher(),this.initPlayer(),this.initSimpleTimeTeleporterWorldColliders(),this.initSimpleTimeTeleporterObjectsColliders(),this.initDoubleTimeTeleportersObjectsColliders(),this.initDoubleTimeTeleportersWorldColliders()}update(e,t){super.update(e,t),this.checkForSpatialTeleportersActivation(),this.checkForSimpleSwitcherActivation(),this.checkForDoubleSwitcherActivation()}},class extends L{constructor(){super(i.Level6,i.PreloadLevel7,"level6")}create(){super.create(),this.createMultiTimeTeleporterByNum(0),this.createMultiTimeTeleporterByNum(1),this.createMultiTimeTeleporterByNum(2),this.createMultiSwitcherByNum(0),this.createMultiSwitcherByNum(1),this.createMultiSwitcherByNum(2),this.initPlayer(),this.initMultiTimeTeleportersObjectsCollidersByNum(0),this.initMultiTimeTeleportersObjectsCollidersByNum(1),this.initMultiTimeTeleportersObjectsCollidersByNum(2),this.initMultiTimeTeleportersWorldColliders(),this.closeMultiTimeTeleporters(),this.initMultiTimeTeleportersOpposites(),this.listenToMultiTimeTeleportersEvents(),this.addDialog(0,this.translate.get(i.Level6,0)),this.addDialog(1,this.translate.get(i.Level6,1))}update(e,t){super.update(e,t),this.checkForSpatialTeleportersActivation(),this.checkForMultiSwitchersActivation()}},class extends L{constructor(){super(i.Level7,i.PreloadLevel8,"level7")}create(){super.create(),this.createDoubleTimeTeleporters(),this.createDoubleSwitcher(),this.createMultiTimeTeleporterByNum(0),this.createMultiTimeTeleporterByNum(1),this.createMultiTimeTeleporterByNum(2),this.createSimpleTimeTeleporter(),this.createSimpleSwitcher(),this.createMultiSwitcherByNum(0),this.createMultiSwitcherByNum(1),this.createMultiSwitcherByNum(2),this.initPlayer(),this.initMultiTimeTeleportersObjectsCollidersByNum(0),this.initMultiTimeTeleportersObjectsCollidersByNum(1),this.initMultiTimeTeleportersObjectsCollidersByNum(2),this.initMultiTimeTeleportersWorldColliders(),this.initSimpleTimeTeleporterWorldColliders(),this.initSimpleTimeTeleporterObjectsColliders(),this.initDoubleTimeTeleportersObjectsColliders(),this.initDoubleTimeTeleportersWorldColliders(),this.closeMultiTimeTeleporters(),this.initMultiTimeTeleportersOpposites(),this.listenToMultiTimeTeleportersEvents()}update(e,t){super.update(e,t),this.checkForSpatialTeleportersActivation(),this.checkForSimpleSwitcherActivation(),this.checkForDoubleSwitcherActivation(),this.checkForMultiSwitchersActivation()}},class extends L{constructor(){super(i.Level8,i.PreloadLevel1,"level8"),this.endPlayed=!1}create(){super.create(),this.initPlayer(),this.addDialog(0,this.translate.get(i.Level8,0));const e=this.tilemap.findObject(r.PLAYER,(e=>e.name===a.CORPSE));e&&(this.corpse=this.add.sprite(e.x,e.y,"player","death-5")),this.events.on("MyTextBox::complete",(()=>{alert(this.translate.get(i.Level8,1))}),this)}update(e,t){super.update(e,t),!this.utils.intersectObjects(this.corpse,this.player)||this.allowsTutorials||this.endPlayed||(this.endPlayed=!0,alert(this.translate.get(i.Level8,1)))}}],physics:{default:"arcade",arcade:{debug:!0,gravity:{y:500}}},plugins:{scene:[{key:"rexUI",plugin:o.Z,mapping:"rexUI"},{key:"store",plugin:I,mapping:"store"},{key:"translate",plugin:N,mapping:"translate"},{key:"utils",plugin:F,mapping:"utils"}]}};window.addEventListener("load",(()=>{new Phaser.Game(W)}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function i(e){var a=s[e];if(void 0!==a)return a.exports;var r=s[e]={exports:{}};return t[e].call(r.exports,r,r.exports,i),r.exports}i.m=t,e=[],i.O=(t,s,a,r)=>{if(!s){var o=1/0;for(c=0;c<e.length;c++){for(var[s,a,r]=e[c],l=!0,n=0;n<s.length;n++)(!1&r||o>=r)&&Object.keys(i.O).every((e=>i.O[e](s[n])))?s.splice(n--,1):(l=!1,r<o&&(o=r));if(l){e.splice(c--,1);var h=a();void 0!==h&&(t=h)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[s,a,r]},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var a,r,[o,l,n]=s,h=0;if(o.some((t=>0!==e[t]))){for(a in l)i.o(l,a)&&(i.m[a]=l[a]);if(n)var c=n(i)}for(t&&t(s);h<o.length;h++)r=o[h],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return i.O(c)},s=self.webpackChunkparadoxe=self.webpackChunkparadoxe||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.O(void 0,[216],(()=>i(108)));var a=i.O(void 0,[216],(()=>i(204)));a=i.O(a)})();